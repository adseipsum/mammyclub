<?php if (!defined("BASEPATH")) exit("No direct script access allowed");
/**
 * WarehouseTypeManager
 * This class has been auto-generated by Itirra
 */
require_once APPPATH . 'logic/base/BaseManager.php';
class WarehouseTypeManager extends BaseManager {

  /** Fields. */
  public $fields = array("name" => array("type" => "input", "class" => "required", "attrs" => array("maxlength" => 255)),
                         "ref" => array("type" => "input", "class" => "required", "attrs" => array("maxlength" => 50)));

  /** List params. */
  public $listParams = array("name");


	/**
	 * NP sync
	 */
	public function sync() {

    $CI = &get_instance();
    $CI->load->library('NewPostSdk');
    $CI->newpostsdk->setApiKey('eb5218a4df21f575da127c06afe055a7');

    $types = $CI->newpostsdk->getWarehouseTypes();

    foreach ($types as $type) {
      $entity = array();
      $entity['name'] = $type->Description;

      $exists = ManagerHolder::get('WarehouseType')->existsWhere(array('ref' => $type->Ref));
      if ($exists) {
        ManagerHolder::get('WarehouseType')->updateAllWhere(array('ref' => $type->Ref), $entity);
      } else {
        $entity['ref'] = $type->Ref;
        ManagerHolder::get('WarehouseType')->insert($entity);
      }
    }
  }

}