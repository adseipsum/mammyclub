<?php if (!defined("BASEPATH")) exit("No direct script access allowed");
/**
 * TaskScheduleManager
 * This class has been auto-generated by Itirra
 */
require_once APPPATH . 'logic/base/BaseManager.php';
class TaskScheduleManager extends BaseManager {


  /** Fields. */
  public $fields = array("name" => array("type" => "input", "attrs" => array("maxlength" => 255)),
                         "is_active" => array("type" => "checkbox"),
//                         "event" => array("type" => "input", "attrs" => array("maxlength" => 255)),
//                         "task_type" => array("type" => "enum"),
                         "execution_type" => array("type" => "enum"),
                         "execution_hour" => array("type" => "input_integer"),
                         "execution_min" => array("type" => "input_integer"),
                         "send_notification" => array("type" => "enum"),
                         "admin_notification_template" => array("type" => "select", "relation" => array("entity_name" => "AdminNotificationTemplate")),
//                         "task_data" => array("type" => "textarea", "class" => "charCounter", "attrs" => array("maxlength" => 1000))
  );

  /** List params. */
  public $listParams = array("name", "task_type", "is_active");


  /**
   * @param $event
   * @param $data
   * @param $date
   * @param string $sendNotificationOn
   * @param null $adminNotificationTemplateId
   */
  public function createOneTimeEvent($event, $data, $date, $sendNotificationOn = 'never', $adminNotificationTemplateId = NULL) {
    $task = array();
    $task['is_active'] = TRUE;
    $task['event'] = $event;
    $task['task_type'] = 'one_time';

    $time = strtotime($date);
    $task['execution_date'] = date('Y-m-d', $time);
    $task['execution_time'] = date('H:i:s', $time);
    $task['task_data'] = json_encode($data);
    $task['send_notification'] = $sendNotificationOn;
    $task['admin_notification_template_id'] = $adminNotificationTemplateId;
    ManagerHolder::get('TaskSchedule')->insert($task);
  }

}