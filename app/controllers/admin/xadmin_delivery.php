<?php if (!defined("BASEPATH")) exit("No direct script access allowed");
/**
 * xAdmin_Delivery
 * This class has been auto-generated by Itirra
 */
require_once APPPATH . 'controllers/admin/base/base_admin_controller.php';

class xAdmin_Delivery extends Base_Admin_Controller {

	/** Filters. */
	protected $filters = array("is_active" => "");

	/** SearchParams. */
	protected $searchParams = array("name");

	/**
	 * AddEditEntity.
	 * Inserts/Updates entity in DBadd_popup.
	 * Sets flash message.
	 *
	 * @param Object $entity
	 * @return Object
	 */
	protected function addEditEntity($entity) {
		/* Check the similarity of the amounts of delivery */
		$entity = $entity->toArray();
		$whereRangeExist = array(
			'order_price_to >=' => $entity['order_price_from'],
			'order_price_from <=' => $entity['order_price_to']
		);
		if (isset($entity['id'])) {
			$whereRangeExist['id<>'] = $entity['id'];
		}
		$result = ManagerHolder::get('Delivery')->existsWhere($whereRangeExist);
		if ($result) {
			set_flash_error('Доставка в данном диапазоне существует.');
			$this->redirectToReffer();
		}
		/* End of check */

		return parent::addEditEntity($entity);
	}


}