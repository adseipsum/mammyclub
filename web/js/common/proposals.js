function init_proposals_logic(d,b,c,h){function g(k,j){if(j){k.find(".loader").show();k.find(".actions-container").hide()}else{k.find(".actions-container").show();k.find(".loader").hide()}}function f(j){if(j.hasClass("even")){return"#F3F3F3"}else{return"#FFFFFF"}}function i(j){var l=j.children("td");var k=f(j);l.css({backgroundColor:"#ffffff"});l.animate({backgroundColor:"#BBFFB6"},400);l.animate({backgroundColor:k},400,function(){l.css({backgroundColor:""})})}function a(n){var m=$.ui.keyCode;var l=[m.TAB,m.LEFT,m.UP,m.DOWN,m.RIGHT,m.END,m.HOME,m.MENU,m.PAGE_UP,m.PAGE_DOWN,m.WINDOWS,116];if($(n.target).hasClass("qty")){l=[m.TAB,m.END,m.HOME,m.MENU,m.PAGE_UP,m.PAGE_DOWN,m.WINDOWS,116]}var j=false;for(var k in l){if(l[k]==n.keyCode){j=true}}if(n.keyCode==m.ENTER){$(n.target).closest("tr").find(".save").click();n.preventDefault();return false}if(!j){e(n)}}function e(k){var j=$(k.target);$saveBtn=j.closest("tr").find(".save");if($saveBtn.hasClass("inactive")){$saveBtn.addClass("small-orange-button").removeClass("inactive")}if(j.hasClass("price")||j.hasClass("price-rent")){j.data("changed",true)}}$(".qty").keypress(a);$(".price").keypress(a);$(".price-rent").keypress(a);$(".published").click(e);$(".qty").bind("paste",function(j){e(j)});$(".price").bind("paste",function(j){e(j)});$(".price-rent").bind("paste",function(j){e(j)});$(".save").click(function(o){if(!$(this).hasClass("small-orange-button")){return false}var l=$(this).closest("tr");var m=new Object();g(l,true);var n=l.find("input.price");var j=l.find("input.price-rent");m.id=l.find("input.id").val();m.published=l.find("input.published").attr("checked")?1:0;m.stock_quantity=l.find("input.qty").val();m.mis_type=d;m[d+"_id"]=l.find("input.mis_id").val();if(n.data("changed")){m.price=n.val()}if(j.data("changed")){m.price_rent=j.val()}var k=$.query.get("valuta");if(k){m.currency=k}$.ajax({type:"POST",url:b,data:m,dataType:"json",success:function(p){if(p.data.price==""){p.data.price="0.00"}if(p.data.price_rent==""){p.data.price_rent="0.00"}l.find("input.price").val(p.data.price);l.find("input.price-rent").val(p.data.price_rent);l.find("input.qty").val(p.data.stock_quantity);l.find("input.id").val(p.data.id);i(l);g(l,false);if(p.data.id){l.find(".add-link").hide().addClass("disabled");l.find(".edit-actions").show().children(".save").removeClass("disabled")}l.find(".save").removeClass("small-orange-button").addClass("inactive")}})});$(".delete").click(function(){var j=$(this).closest("tr");var m=j.children("td");var l=f(j);j.children("td").css("background-color","red");if(confirm("Вы уверены, что хотите удалить это предложение?")){j.children("td").css("background-color",l);var k=new Object();g(j,true);k.id=j.find("input.id").val();k.mis_type=d;$.ajax({type:"POST",url:c,data:k,dataType:"json",success:function(n){g(j,false);if(h){j.find(".add-link").show().removeClass("disabled");j.find(".edit-actions").hide().children(".save").addClass("disabled");j.find("input.price").val("0.00");j.find("input.price-rent").val("0.00");j.find("input.qty").val("0");j.find("input.id").val("");j.find("input.published").removeAttr("checked");i(j)}else{j.fadeOut(800,function(){j.remove()})}}})}else{j.children("td").css("background-color",l)}});$("#save-all").click(function(){$(".proposals-form").submit()});$(".qty").spinner({min:0});$(".ui-spinner").click(e);$("#import-link").click(function(){$("#import-form").slideDown();$(this).hide();$(this).next(".add").hide()});$(".search-box form.query-params").append('<input type="hidden" name="proizvoditel" value="" />')};