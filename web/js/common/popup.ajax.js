(function(f,d,a){var e=null,c=null;function b(l){var n=f(d).scrollTop(),g=0,i=0,j=0,m=f(d).height(),k=f(d).width(),o=l.getOverlay().height(),h=l.getOverlay().width();if(m>o){n=m/2-o/2+f(d).scrollTop()}if(k>h){i=k/2-h/2}l.getOverlay().css({top:n,left:i})}f.popupAlert=function(g){if(c){c.message=g;c.load();return false}f("#popup-alert").overlay({top:"center",fixed:false,mask:{opacity:0.5,color:"#000",loadSpeed:200},onClose:function(){this.getOverlay().css({top:"auto",left:"auto"});f(d).unbind("resize.overlay").unbind("scroll.overlay")},onBeforeClose:function(){this.getOverlay().find("form :input").each(function(){f(this).tooltip().hide()})},onBeforeLoad:function(){if(!c){c=this;c.message=g}c.getOverlay().find(".close-button").unbind().click(function(){c.close();return false});c.getOverlay().find(".msg").html(c.message);b(c);f(d).bind("resize.overlay",function(){b(c);f("#exposeMask").width(f(d).width())}).bind("scroll.overlay",function(){f("#exposeMask").width(f(d).width())})},load:true,closeOnClick:true})};f.popupConfirm=function(g,h){f.popupConfirm.callback=h;if(e){e.load();return false}f("#popup-confirm").overlay({top:"center",fixed:false,mask:{opacity:0.5,color:"#000",loadSpeed:200},onBeforeClose:function(){this.getOverlay().find("form :input").each(function(){f(this).tooltip().hide()})},onClose:function(){this.getOverlay().css({top:"auto",left:"auto"});f(d).unbind("resize.overlay").unbind("scroll.overlay")},onBeforeLoad:function(){e=this;e.getOverlay().find(".ok-button").unbind().click(function(){e.close();if(f.popupConfirm.callback){f.popupConfirm.callback(true)}});e.getOverlay().find(".close-button").unbind().click(function(){e.close();if(f.popupConfirm.callback){f.popupConfirm.callback(false)}return false});g=g?g:"Пожалуйста, подтвердите свои действия.";e.getOverlay().find(".msg").html(g);b(e);f(d).bind("resize.overlay",function(){b(e);f("#exposeMask").width(f(d).width())}).bind("scroll.overlay",function(){f("#exposeMask").width(f(d).width())})},load:true,closeOnClick:false})};f.PopupAjaxManager=new function(){var h;var n;var q="";var k;function i(t,s){if(s){t.getOverlay().find(".popup-content").html(s.show());b(t)}}function p(v,s){if(!v){return false}v=f.parseResponseByType(v);if(v.type=="html"){s.getOverlay().find(".popup-content").html(v.data);r.call(s)}else{var t=v.data;t=t.data?t.data:t;if(t.redirect){if(!t.top){f.post(t.redirect,function(w){p(w,s)})}else{if(t.top){var u=d.location.href;if(u.split("#")[0]==t.redirect.split("#")[0]){d.location.reload()}else{d.location.href=t.redirect}}}}}}function m(s,t){i(k,n);f.post(s,t,function(u){p(u,k)})}function l(s,t){t.unbind("submit").submit(function(){t.ajaxSubmit({beforeSubmit:function(u,v,w){i(s,n)},success:function(u){p(u,s)}});t.find("[placeholder]").blur();return false});t.find("[placeholder]").each(function(){if(f(this).attr("placeholder")==f(this).val()){f(this).val("")}});if(t.find("input:submit").length>0){t.find("input:submit")[0].click()}else{t.submit()}}function o(u,t,s){u.overlay({top:"center",fixed:false,mask:{opacity:0.5,color:"#000",loadSpeed:200},onBeforeClose:function(){this.getOverlay().find("form :input").each(function(){f(this).tooltip().hide()})},onClose:function(){i(this,n);if(q){this.getOverlay().removeClass(q)}k.getOverlay().css({top:"auto",left:"auto"});f(d).unbind("resize.overlay").unbind("scroll.overlay")},onBeforeLoad:function(){if(!n){n=this.getOverlay().find(".preloader").clone()}var v=this;f.PopupAjaxManager.metadata=v.getTrigger().metadata();if(v.getTrigger().hasClass("submit")){l(v,v.getTrigger().parents("form"))}else{if(this.getTrigger().attr("href")){f.post(this.getTrigger().attr("href"),function(w){p(w,v)})}else{if(s){f.post(s,function(w){p(w,v)})}}}f(d).bind("resize.overlay",function(){b(v);f("#exposeMask").width(f(d).width())}).bind("scroll.overlay",function(){f("#exposeMask").width(f(d).width())})},load:t?t:false,closeOnClick:false})}function g(s){s.overlay({top:"center",fixed:false,mask:{opacity:0.5,color:"#000",loadSpeed:200},onBeforeClose:function(){this.getOverlay().find("form :input").each(function(){f(this).tooltip().hide()})},onClose:function(){if(q){this.getOverlay().removeClass(q)}k.getOverlay().css({top:"auto",left:"auto"});f(d).unbind("resize.overlay").unbind("scroll.overlay")},onBeforeLoad:function(){if(!n){n=this.getOverlay().find(".loading").clone()}k=this;k.getOverlay().find(".ok-button").attr("href",this.getTrigger().attr("href"));var t="Пожалуйста, подтвердите свои действия.";if(this.getTrigger().data("message")){t=this.getTrigger().data("message")}k.getOverlay().find(".msg").html(t);k.getOverlay().find("a").unbind();r.call(k);f(d).bind("resize.overlay",function(){b(k);f("#exposeMask").width(f(d).width())}).bind("scroll.overlay",function(){f("#exposeMask").width(f(d).width())})},load:false,closeOnClick:false})}function j(u,t,s){if(u.length>0){u.each(function(){var v=f(this);v.removeClass("ajax-popup");if(v.hasClass("submit")&&v.parents("form").hasClass("validate")){v.parents("form").validate({errorElement:"span",submitHandler:function(w){o(v,true,s)}});v.click(function(){v.parents("form").submit();return false})}else{if(v.hasClass("confirm")){g(v)}else{o(v,t,s)}}})}}function r(){k=this;if(q){k.getOverlay().removeClass(q)}if(q=(k.getTrigger().attr("class")!="overlay"?k.getTrigger().attr("class"):"")){q=q.split(" ");q=q[q.length-1];k.getOverlay().addClass(q)}b(k);k.getOverlay().find("form").validate({errorElement:"span",submitHandler:function(s){l(k,k.getOverlay().find("form"))}});k.getOverlay().find(".popup-content a").filter(":not(.processingLink)").filter(":not(.submit-button)").filter(":not(.close-button)").filter(":not(.top)").filter(":not(.exclude)").filter(":not(.YMaps-slider-plus)").filter(":not(.YMaps-slider-minus)").click(function(){i(k,n);f.post(f(this).attr("href"),function(s){p(s,k)});return false});k.getOverlay().find(".popup-content a.processingLink").click(function(){i(k,n);f.post(f(this).attr("href"),function(s){p(s,k)});return false});k.getOverlay().find(".close-button").click(function(){k.close();return false});k.getOverlay().find(".submit-button").click(function(){if(!f(this).hasClass("disabled")){var s=f(this).metadata();if(s){for(var t in s){f(this).parents("form").append('<input type="hidden" name="'+t+'" value="'+s[t]+'" />')}}f(this).parents("form").submit()}return false})}return h={init:function(s){j(f(".ajax-popup",s?s:a));if(f.PopupAjaxManager.popupUrl){j(f("#popup"),true,f.PopupAjaxManager.popupUrl)}},showPopup:function(s){j(f("#popup"),true,s);k.load()},close:function(){k.close()},redirect:function(s,t){m(s,t)}}};f.assignAjaxPopup=function(g){f.PopupAjaxManager.init(g)}})(jQuery,window,document);