tinymce.PluginManager.add("textcolor",function(p){function j(a){var c;return p.dom.getParents(p.selection.getStart(),function(e){var i;(i=e.style["forecolor"==a?"color":"background-color"])&&(c=i)}),c}function d(){var c,i,a=[];for(i=p.settings.textcolor_map||["000000","Black","993300","Burnt orange","333300","Dark olive","003300","Dark green","003366","Dark azure","000080","Navy Blue","333399","Indigo","333333","Very dark gray","800000","Maroon","FF6600","Orange","808000","Olive","008000","Green","008080","Teal","0000FF","Blue","666699","Grayish blue","808080","Gray","FF0000","Red","FF9900","Amber","99CC00","Yellow green","339966","Sea green","33CCCC","Turquoise","3366FF","Royal blue","800080","Purple","999999","Medium gray","FF00FF","Magenta","FFCC00","Gold","FFFF00","Yellow","00FF00","Lime","00FFFF","Aqua","00CCFF","Sky blue","993366","Red violet","FFFFFF","White","FF99CC","Pink","FFCC99","Peach","FFFF99","Light yellow","CCFFCC","Pale green","CCFFFF","Pale cyan","99CCFF","Light sky blue","CC99FF","Plum"],c=0;c<i.length;c+=2){a.push({text:i[c+1],color:"#"+i[c]})}return a}function b(){function w(a,c){var l="transparent"==a;return'<td class="mce-grid-cell'+(l?" mce-colorbtn-trans":"")+'"><div id="'+s+"-"+B+++'" data-mce-color="'+(a?a:"")+'" role="option" tabIndex="-1" style="'+(a?"background-color: "+a:"")+'" title="'+tinymce.translate(c)+'">'+(l?"&#215;":"")+"</div></td>"}var i,t,z,o,y,x,A,v=this,s=v._id,B=0;for(i=d(),i.push({text:tinymce.translate("No color"),color:"transparent"}),z='<table class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody>',o=i.length-1,x=0;q>x;x++){for(z+="<tr>",y=0;h>y;y++){A=x*h+y,A>o?z+="<td></td>":(t=i[A],z+=w(t.color,t.text))}z+="</tr>"}if(p.settings.color_picker_callback){for(z+='<tr><td colspan="'+h+'" class="mce-custom-color-btn"><div id="'+s+'-c" class="mce-widget mce-btn mce-btn-small mce-btn-flat" role="button" tabindex="-1" aria-labelledby="'+s+'-c" style="width: 100%"><button type="button" role="presentation" tabindex="-1">'+tinymce.translate("Custom...")+"</button></div></td></tr>",z+="<tr>",y=0;h>y;y++){z+=w("","Custom color")}z+="</tr>"}return z+="</tbody></table>"}function g(a,c){p.focus(),p.formatter.apply(a,{value:c}),p.nodeChanged()}function m(a){p.focus(),p.formatter.remove(a,{value:null},null,!0),p.nodeChanged()}function f(i){function e(c){a.hidePanel(),a.color(c),g(a.settings.format,c)}function t(c,n){c.style.background=n,c.setAttribute("data-mce-color",n)}var l,a=this.parent();if(tinymce.DOM.getParent(i.target,".mce-custom-color-btn")&&(a.hidePanel(),p.settings.color_picker_callback.call(p,function(r){var s,u,n,c=a.panel.getEl().getElementsByTagName("table")[0];for(s=tinymce.map(c.rows[c.rows.length-1].childNodes,function(o){return o.firstChild}),n=0;n<s.length&&(u=s[n],u.getAttribute("data-mce-color"));n++){}if(n==h){for(n=0;h-1>n;n++){t(s[n],s[n+1].getAttribute("data-mce-color"))}}t(u,r),e(r)},j(a.settings.format))),l=i.target.getAttribute("data-mce-color")){if(this.lastId&&document.getElementById(this.lastId).setAttribute("aria-selected",!1),i.target.setAttribute("aria-selected",!0),this.lastId=i.target.id,"transparent"==l){return m(a.settings.format),void a.hidePanel()}e(l)}else{null!==l&&a.hidePanel()}}function k(){var a=this;a._color&&g(a.settings.format,a._color)}var h,q;q=p.settings.textcolor_rows||5,h=p.settings.textcolor_cols||8,p.addButton("forecolor",{type:"colorbutton",tooltip:"Text color",format:"forecolor",panel:{role:"application",ariaRemember:!0,html:b,onclick:f},onclick:k}),p.addButton("backcolor",{type:"colorbutton",tooltip:"Background color",format:"hilitecolor",panel:{role:"application",ariaRemember:!0,html:b,onclick:f},onclick:k})});