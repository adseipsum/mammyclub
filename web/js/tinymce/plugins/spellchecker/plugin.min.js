!function(B,G){function q(f,c){for(var g,d=[],a=0;a<f.length;++a){if(g=H[f[a]]||k(f[a]),!g){throw"module definition dependecy not found: "+f[a]}d.push(g)}c.apply(null,d)}function b(d,c,a){if("string"!=typeof d){throw"invalid module definition, module id must be defined and be a string"}if(c===G){throw"invalid module definition, dependencies must be specified"}if(a===G){throw"invalid module definition, definition function must be specified"}q(c,function(){H[d]=a.apply(null,arguments)})}function x(a){return !!H[a]}function k(c){for(var e=B,d=c.split(/[.\/]/),a=0;a<d.length;++a){if(!e[d[a]]){return}e=e[d[a]]}return e}function E(h){for(var f=0;f<h.length;f++){for(var e=B,g=h[f],d=g.split(/[.\/]/),c=0;c<d.length-1;++c){e[d[c]]===G&&(e[d[c]]={}),e=e[d[c]]}e[d[d.length-1]]=H[g]}}var H={},w="tinymce/spellcheckerplugin/DomTextMatcher",D="tinymce/spellcheckerplugin/Plugin",F="tinymce/PluginManager",C="tinymce/util/Tools",A="tinymce/ui/Menu",j="tinymce/dom/DOMUtils",v="tinymce/util/XHR",y="tinymce/util/URI",z="tinymce/util/JSON";b(w,[],function(){return function(ae,Q){function W(c,a){if(!c[0]){throw"findAndReplaceDOMText cannot handle zero-length matches"}return{start:c.index,end:c.index+c[0].length,text:c[0],data:a}}function T(c){var a;if(3===c.nodeType){return c.data}if(I[c.nodeName]&&!Z[c.nodeName]){return""}if(a="",(Z[c.nodeName]||P[c.nodeName])&&(a+="\n"),c=c.firstChild){do{a+=T(c)}while(c=c.nextSibling)}return a}function aa(N,ao,h){var f,p,g,am,ap=[],m=0,al=N,an,ak=0;ao=ao.slice(0),ao.sort(function(c,a){return c.start-a.start}),an=ao.shift();N:for(;;){if((Z[al.nodeName]||P[al.nodeName])&&m++,3===al.nodeType&&(!p&&al.length+m>=an.end?(p=al,am=an.end-m):f&&ap.push(al),!f&&al.length+m>an.start&&(f=al,g=an.start-m),m+=al.length),f&&p){if(al=h({startNode:f,startNodeIndex:g,endNode:p,endNodeIndex:am,innerNodes:ap,match:an.text,matchIndex:ak}),m-=p.length-am,f=null,p=null,ap=[],an=ao.shift(),ak++,!an){break}}else{if((!I[al.nodeName]||Z[al.nodeName])&&al.firstChild){al=al.firstChild;continue}if(al.nextSibling){al=al.nextSibling;continue}}for(;;){if(al.nextSibling){al=al.nextSibling;break}if(al.parentNode===N){break N}al=al.parentNode}}}function V(c){function a(e,g){var f=K[g];f.stencil||(f.stencil=c(f));var d=f.stencil.cloneNode(!1);return d.setAttribute("data-mce-index",g),e&&d.appendChild(aj.doc.createTextNode(e)),d}return function(at){var al,t,ao,ak=at.startNode,aw=at.endNode,az=at.matchIndex,an=aj.doc;if(ak===aw){var av=ak;ao=av.parentNode,at.startNodeIndex>0&&(al=an.createTextNode(av.data.substring(0,at.startNodeIndex)),ao.insertBefore(al,av));var ay=a(at.match,az);return ao.insertBefore(ay,av),at.endNodeIndex<av.length&&(t=an.createTextNode(av.data.substring(at.endNodeIndex)),ao.insertBefore(t,av)),av.parentNode.removeChild(av),ay}al=an.createTextNode(ak.data.substring(0,at.startNodeIndex)),t=an.createTextNode(aw.data.substring(at.endNodeIndex));for(var au=a(ak.data.substring(at.startNodeIndex),az),ar=[],N=0,am=at.innerNodes.length;am>N;++N){var ap=at.innerNodes[N],aq=a(ap.data,az);ap.parentNode.replaceChild(aq,ap),ar.push(aq)}var ax=a(aw.data.substring(0,at.endNodeIndex),az);return ao=ak.parentNode,ao.insertBefore(al,ak),ao.insertBefore(au,ak),ao.removeChild(ak),ao=aw.parentNode,ao.insertBefore(ax,aw),ao.insertBefore(t,aw),ao.removeChild(aw),ax}}function ai(c){var a=c.parentNode;a.insertBefore(c.firstChild,c),c.parentNode.removeChild(c)}function R(e){var h=ae.getElementsByTagName("*"),f=[];e="number"==typeof e?""+e:null;for(var d=0;d<h.length;d++){var g=h[d],c=g.getAttribute("data-mce-index");null!==c&&c.length&&(c===e||null===e)&&f.push(g)}return f}function Y(c){for(var a=K.length;a--;){if(K[a]===c){return a}}return -1}function ag(c){var a=[];return O(function(e,d){c(e,d)&&a.push(e)}),K=a,this}function O(c){for(var a=0,d=K.length;d>a&&c(K[a],a)!==!1;a++){}return this}function af(a){return K.length&&aa(ae,K,V(a)),this}function ad(c,a){if(L&&c.global){for(;S=c.exec(L);){K.push(W(S,a))}}return this}function U(c){var a,d=R(c?Y(c):null);for(a=d.length;a--;){ai(d[a])}return this}function X(a){return K[a.getAttribute("data-mce-index")]}function ab(a){return R(Y(a))[0]}function ac(c,a,d){return K.push({start:c,end:c+a,text:L.substr(c,a),data:d}),this}function M(c){var d=R(Y(c)),a=Q.dom.createRng();return a.setStartBefore(d[0]),a.setEndAfter(d[d.length-1]),a}function J(c,d){var a=M(c);return a.deleteContents(),d.length>0&&a.insertNode(Q.dom.doc.createTextNode(d)),a}function ah(){return K.splice(0,K.length),U(),this}var S,K=[],L,aj=Q.dom,Z,I,P;return Z=Q.schema.getBlockElements(),I=Q.schema.getWhiteSpaceElements(),P=Q.schema.getShortEndedElements(),L=T(ae),{text:L,matches:K,each:O,filter:ag,reset:ah,matchFromElement:X,elementFromMatch:ab,find:ad,add:ac,wrap:af,unwrap:U,replace:J,rangeFromMatch:M,indexOf:Y}}}),b(D,[w,F,C,A,j,v,y,z],function(l,f,p,h,d,m,c,g){f.add("spellchecker",function(L,W){function ac(){return n.textMatcher||(n.textMatcher=new l(L.getBody(),L)),n.textMatcher}function J(R,u){var N=[];return p.each(u,function(t){N.push({selectable:!0,text:t.name,data:t.value})}),N}function ab(N){for(var u in N){return !1}return !0}function aa(T,af){var N=[],S=K[T];p.each(S,function(u){N.push({text:u,onclick:function(){L.insertContent(L.dom.encode(u)),L.dom.remove(af),I()}})}),N.push({text:"-"}),Q&&N.push({text:"Add to Dictionary",onclick:function(){o(T,af)}}),N.push.apply(N,[{text:"Ignore",onclick:function(){ad(T,af)}},{text:"Ignore all",onclick:function(){ad(T,af,!0)}},{text:"Finish",onclick:O}]),a=new h({items:N,context:"contextmenu",onautohide:function(u){-1!=u.target.className.indexOf("spellchecker")&&u.preventDefault()},onhide:function(){a.remove(),a=null}}),a.renderTo(document.body);var t=d.DOM.getPos(L.getContentAreaContainer()),ag=L.dom.getPos(af[0]),R=L.dom.getRoot();"BODY"==R.nodeName?(ag.x-=R.ownerDocument.documentElement.scrollLeft||R.scrollLeft,ag.y-=R.ownerDocument.documentElement.scrollTop||R.scrollTop):(ag.x-=R.scrollLeft,ag.y-=R.scrollTop),t.x+=ag.x,t.y+=ag.y,a.moveTo(t.x,t.y+af[0].offsetHeight)}function U(){return L.getParam("spellchecker_wordchar_pattern")||new RegExp('[^\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`\xa7\xa9\xab\xae\xb1\xb6\xb7\xb8\xbb\xbc\xbd\xbe\xbf\xd7\xf7\xa4\u201d\u201c\u201e]+',"g")}function V(af,S,T,R){var ag={method:af},N="";"spellcheck"==af&&(ag.text=S,ag.lang=i.spellchecker_language),"addToDictionary"==af&&(ag.word=S),p.each(ag,function(ah,u){N&&(N+="&"),N+=u+"="+encodeURIComponent(ah)}),m.send({url:new c(W).toAbsolute(i.spellchecker_rpc_url),type:"post",content_type:"application/x-www-form-urlencoded",data:N,success:function(t){t=g.parse(t),t?t.error?R(t.error):T(t):R("Sever response wasn't proper JSON.")},error:function(ah,u){R("Spellchecker request error: "+u.status)}})}function Y(S,N,T,R){var u=i.spellchecker_callback||V;u.call(n,S,N,T,R)}function Z(){function t(N){var R;return N.words?(Q=!!N.dictionary,R=N.words):R=N,L.setProgressState(!1),ab(R)?(L.windowManager.alert("No misspellings found"),void (e=!1)):(K=R,ac().find(U()).filter(function(S){return !!R[S.text]}).wrap(function(S){return L.dom.create("span",{"class":"mce-spellchecker-word","data-mce-bogus":1,"data-mce-word":S.text})}),void L.fire("SpellcheckStart"))}function u(N){L.windowManager.alert(N),L.setProgressState(!1),O()}return e?void O():(O(),e=!0,L.setProgressState(!0),Y("spellcheck",ac().text,t,u),void L.focus())}function I(){L.dom.select("span.mce-spellchecker-word").length||O()}function o(t,u){L.setProgressState(!0),Y("addToDictionary",t,function(){L.setProgressState(!1),L.dom.remove(u,!0),I()},function(N){L.windowManager.alert(N),L.setProgressState(!1)})}function ad(N,u,t){L.selection.collapse(),t?p.each(L.dom.select("span.mce-spellchecker-word"),function(R){R.getAttribute("data-mce-word")==N&&L.dom.remove(R,!0)}):L.dom.remove(u,!0),I()}function O(){ac().reset(),n.textMatcher=null,e&&(e=!1,L.fire("SpellcheckEnd"))}function r(N){var u=N.getAttribute("data-mce-index");return"number"==typeof u?""+u:u}function s(R){var N,u=[];if(N=p.toArray(L.getBody().getElementsByTagName("span")),N.length){for(var S=0;S<N.length;S++){var t=r(N[S]);null!==t&&t.length&&t===R.toString()&&u.push(N[S])}}return u}function ae(N){var u=i.spellchecker_language;N.control.items().each(function(t){t.active(t.settings.data===u)})}var X,n=this,K,e,a,i=L.settings,Q,P=i.spellchecker_languages||"English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv";X=J("Language",p.map(P.split(","),function(t){return t=t.split("="),{name:t[0],value:t[1]}})),L.on("click",function(N){var R=N.target;if("mce-spellchecker-word"==R.className){N.preventDefault();var u=s(r(R));if(u.length>0){var t=L.dom.createRng();t.setStartBefore(u[0]),t.setEndAfter(u[u.length-1]),L.selection.setRng(t),aa(R.getAttribute("data-mce-word"),u)}}}),L.addMenuItem("spellchecker",{text:"Spellcheck",context:"tools",onclick:Z,selectable:!0,onPostRender:function(){var t=this;L.on("SpellcheckStart SpellcheckEnd",function(){t.active(e)})}});var M={tooltip:"Spellcheck",onclick:Z,onPostRender:function(){var t=this;L.on("SpellcheckStart SpellcheckEnd",function(){t.active(e)})}};X.length>1&&(M.type="splitbutton",M.menu=X,M.onshow=ae,M.onselect=function(t){i.spellchecker_language=t.control.settings.data}),L.addButton("spellchecker",M),L.addCommand("mceSpellCheck",Z),L.on("remove",function(){a&&(a.remove(),a=null)}),L.on("change",I),this.getTextMatcher=ac,this.getWordCharPattern=U,this.getLanguage=function(){return i.spellchecker_language},i.spellchecker_language=i.spellchecker_language||i.language||"en"})}),E([w])}(this);