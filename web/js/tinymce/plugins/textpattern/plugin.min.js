tinymce.PluginManager.add("textpattern",function(p){function j(){return g&&(h.sort(function(a,d){return a.start.length>d.start.length?-1:a.start.length<d.start.length?1:0}),g=!1),h}function f(e){for(var i=j(),d=0;d<i.length;d++){if(0===e.indexOf(i[d].start)&&(!i[d].end||e.lastIndexOf(i[d].end)==e.length-i[d].end.length)){return i[d]}}}function m(i,v,e){var o,l,u;for(o=j(),u=0;u<o.length;u++){if(l=o[u],l.end&&i.substr(v-l.end.length-e,l.end.length)==l.end){return l}}}function b(A){function a(){w=w.splitText(z),w.splitText(v-z-x),w.deleteData(0,t.start.length),w.deleteData(w.data.length-t.end.length,t.end.length)}var E,B,n,w,v,z,y,C,t,x,D;return E=p.selection,B=p.dom,E.isCollapsed()&&(n=E.getRng(!0),w=n.startContainer,v=n.startOffset,y=w.data,x=A?1:0,3==w.nodeType&&(t=m(y,v,x),t&&(z=Math.max(0,v-x),z=y.lastIndexOf(t.start,z-t.end.length-1),-1!==z&&(C=B.createRng(),C.setStart(w,z),C.setEnd(w,v-x),t=f(C.toString()),t&&t.end&&!(w.data.length<=t.start.length+t.end.length)))))?(D=p.formatter.get(t.format),D&&D[0].inline?(a(),p.formatter.apply(t.format,{},w),w):void 0):void 0}function q(){var y,B,n,C,z,t,v,u,x,w,A;if(y=p.selection,B=p.dom,y.isCollapsed()&&(v=B.getParent(y.getStart(),"p"))){for(x=new tinymce.dom.TreeWalker(v,v);z=x.next();){if(3==z.nodeType){C=z;break}}if(C){if(u=f(C.data),!u){return}if(w=y.getRng(!0),n=w.startContainer,A=w.startOffset,C==n&&(A=Math.max(0,A-u.start.length)),tinymce.trim(C.data).length==u.start.length){return}u.format&&(t=p.formatter.get(u.format),t&&t[0].block&&(C.deleteData(0,u.start.length),p.formatter.apply(u.format,{},C),w.setStart(n,A),w.collapse(!0),y.setRng(w))),u.cmd&&p.undoManager.transact(function(){C.deleteData(0,u.start.length),p.execCommand(u.cmd)})}}}function k(){var a,d;d=b(),d&&(a=p.dom.createRng(),a.setStart(d,d.data.length),a.setEnd(d,d.data.length),p.selection.setRng(a)),q()}function c(){var o,t,i,l,r;o=b(!0),o&&(r=p.dom,t=o.data.slice(-1),/[\u00a0 ]/.test(t)&&(o.deleteData(o.data.length-1,1),i=r.doc.createTextNode(t),o.nextSibling?r.insertAfter(i,o.nextSibling):o.parentNode.appendChild(i),l=r.createRng(),l.setStart(i,1),l.setEnd(i,1),p.selection.setRng(l)))}var h,g=!0;h=p.settings.textpattern_patterns||[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],p.on("keydown",function(a){13!=a.keyCode||tinymce.util.VK.modifierPressed(a)||k()},!0),p.on("keyup",function(a){32!=a.keyCode||tinymce.util.VK.modifierPressed(a)||c()}),this.getPatterns=j,this.setPatterns=function(a){h=a,g=!0}});