tinymce.PluginManager.add("autolink",function(g){function b(e){f(e,-1,"(",!0)}function d(e){f(e,0,"",!0)}function a(e){f(e,-1,"",!1)}function f(p,F,z){function v(l,h){if(0>h&&(h=0),3==l.nodeType){var i=l.data.length;h>i&&(h=i)}return h}function m(h,e){y.setStart(h,v(h,e))}function j(h,e){y.setEnd(h,v(h,e))}var y,A,D,G,B,q,E,x,w,k;if(y=p.selection.getRng(!0).cloneRange(),y.startOffset<5){if(x=y.endContainer.previousSibling,!x){if(!y.endContainer.firstChild||!y.endContainer.firstChild.nextSibling){return}x=y.endContainer.firstChild.nextSibling}if(w=x.length,m(x,w),j(x,w),y.endOffset<5){return}A=y.endOffset,G=x}else{if(G=y.endContainer,3!=G.nodeType&&G.firstChild){for(;3!=G.nodeType&&G.firstChild;){G=G.firstChild}3==G.nodeType&&(m(G,0),j(G,G.nodeValue.length))}A=1==y.endOffset?2:y.endOffset-1-F}D=A;do{m(G,A>=2?A-2:0),j(G,A>=1?A-1:0),A-=1,k=y.toString()}while(" "!=k&&""!==k&&160!=k.charCodeAt(0)&&A-2>=0&&k!=z);y.toString()==z||160==y.toString().charCodeAt(0)?(m(G,A),j(G,D),A+=1):0===y.startOffset?(m(G,0),j(G,D)):(m(G,A),j(G,D)),q=y.toString(),"."==q.charAt(q.length-1)&&j(G,D-1),q=y.toString(),E=q.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i),E&&("www."==E[1]?E[1]="http://www.":/@$/.test(E[1])&&!/^mailto:/.test(E[1])&&(E[1]="mailto:"+E[1]),B=p.selection.getBookmark(),p.selection.setRng(y),p.execCommand("createlink",!1,E[1]+E[2]),p.selection.moveToBookmark(B),p.nodeChanged())}var c;return g.on("keydown",function(e){return 13==e.keyCode?a(g):void 0}),tinymce.Env.ie?void g.on("focus",function(){if(!c){c=!0;try{g.execCommand("AutoUrlDetect",!1,!0)}catch(e){}}}):(g.on("keypress",function(h){return 41==h.keyCode?b(g):void 0}),void g.on("keyup",function(e){return 32==e.keyCode?d(g):void 0}))});