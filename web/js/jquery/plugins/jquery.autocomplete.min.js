!function(b){"function"==typeof define&&define.amd?define(["jquery"],b):b("object"==typeof exports&&"function"==typeof require?require("jquery"):jQuery)}(function(r){function q(f,b){var a=this;a.element=f,a.el=r(f),a.suggestions=[],a.badQueries=[],a.selectedIndex=-1,a.currentValue=a.element.value,a.timeoutId=null,a.cachedResponse={},a.onChangeTimeout=null,a.onChange=null,a.isLocal=!1,a.suggestionsContainer=null,a.noSuggestionsContainer=null,a.options=r.extend({},q.defaults,b),a.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},a.hint=null,a.hintValue="",a.selection=null,a.initialize(),a.setOptions(b)}function p(e,d,f){return -1!==e.value.toLowerCase().indexOf(f)}function o(a){return"string"==typeof a?r.parseJSON(a):a}function n(e,d){if(!d){return e.value}var f="("+l.escapeRegExChars(d)+")";return e.value.replace(new RegExp(f,"gi"),"<strong>$1</strong>").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/&lt;(\/?strong)&gt;/g,"<$1>")}function m(d,c){return'<div class="autocomplete-group">'+c+"</div>"}var l=function(){return{escapeRegExChars:function(b){return b.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")},createNode:function(d){var c=document.createElement("div");return c.className=d,c.style.position="absolute",c.style.display="none",c}}}(),k={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40},j=r.noop;q.utils=l,r.Autocomplete=q,q.defaults={ajaxSettings:{},autoSelectFirst:!1,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:n,formatGroup:m,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:j,onSearchComplete:j,onSearchError:j,preserveInput:!1,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!0,preventBadQueries:!0,lookupFilter:p,paramName:"query",transformResult:o,showNoSuggestionNotice:!1,noSuggestionNotice:"No results",orientation:"bottom",forceFixPosition:!1},q.prototype={initialize:function(){var s,i=this,h="."+i.classes.suggestion,b=i.classes.selected,a=i.options;i.element.setAttribute("autocomplete","off"),i.noSuggestionsContainer=r('<div class="autocomplete-no-suggestion"></div>').html(this.options.noSuggestionNotice).get(0),i.suggestionsContainer=q.utils.createNode(a.containerClass),s=r(i.suggestionsContainer),s.appendTo(a.appendTo||"body"),"auto"!==a.width&&s.css("width",a.width),s.on("mouseover.autocomplete",h,function(){i.activate(r(this).data("index"))}),s.on("mouseout.autocomplete",function(){i.selectedIndex=-1,s.children("."+b).removeClass(b)}),s.on("click.autocomplete",h,function(){i.select(r(this).data("index"))}),s.on("click.autocomplete",function(){clearTimeout(i.blurTimeoutId)}),i.fixPositionCapture=function(){i.visible&&i.fixPosition()},r(window).on("resize.autocomplete",i.fixPositionCapture),i.el.on("keydown.autocomplete",function(c){i.onKeyPress(c)}),i.el.on("keyup.autocomplete",function(c){i.onKeyUp(c)}),i.el.on("blur.autocomplete",function(){i.onBlur()}),i.el.on("focus.autocomplete",function(){i.onFocus()}),i.el.on("change.autocomplete",function(c){i.onKeyUp(c)}),i.el.on("input.autocomplete",function(c){i.onKeyUp(c)})},onFocus:function(){var b=this;b.fixPosition(),b.el.val().length>=b.options.minChars&&b.onValueChange()},onBlur:function(){var b=this;b.blurTimeoutId=setTimeout(function(){b.hide()},200)},abortAjax:function(){var b=this;b.currentRequest&&(b.currentRequest.abort(),b.currentRequest=null)},setOptions:function(a){var f=this,e=f.options;this.options=r.extend({},e,a),f.isLocal=r.isArray(e.lookup),f.isLocal&&(e.lookup=f.verifySuggestionsFormat(e.lookup)),e.orientation=f.validateOrientation(e.orientation,"bottom"),r(f.suggestionsContainer).css({"max-height":e.maxHeight+"px",width:e.width+"px","z-index":e.zIndex})},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var b=this;b.disabled=!0,clearTimeout(b.onChangeTimeout),b.abortAjax()},enable:function(){this.disabled=!1},fixPosition:function(){var E=this,D=r(E.suggestionsContainer),C=D.parent().get(0);if(C===document.body||E.options.forceFixPosition){var B=E.options.orientation,A=D.outerHeight(),z=E.el.outerHeight(),y=E.el.offset(),x={top:y.top,left:y.left};if("auto"===B){var w=r(window).height(),v=r(window).scrollTop(),u=-v+y.top-A,t=v+w-(y.top+z+A);B=Math.max(u,t)===u?"top":"bottom"}if("top"===B?x.top+=-A:x.top+=z,C!==document.body){var s,a=D.css("opacity");E.visible||D.css("opacity",0).show(),s=D.offsetParent().offset(),x.top-=s.top,x.left-=s.left,E.visible||D.css("opacity",a).hide()}"auto"===E.options.width&&(x.width=E.el.outerWidth()+"px"),D.css(x)}},isCursorAtEnd:function(){var f,e=this,h=e.el.val().length,g=e.element.selectionStart;return"number"==typeof g?g===h:document.selection?(f=document.selection.createRange(),f.moveStart("character",-h),h===f.text.length):!0},onKeyPress:function(d){var c=this;if(!c.disabled&&!c.visible&&d.which===k.DOWN&&c.currentValue){return void c.suggest()}if(!c.disabled&&c.visible){switch(d.which){case k.ESC:c.el.val(c.currentValue),c.hide();break;case k.RIGHT:if(c.hint&&c.options.onHint&&c.isCursorAtEnd()){c.selectHint();break}return;case k.TAB:if(c.hint&&c.options.onHint){return void c.selectHint()}if(-1===c.selectedIndex){return void c.hide()}if(c.select(c.selectedIndex),c.options.tabDisabled===!1){return}break;case k.RETURN:if(-1===c.selectedIndex){return void c.hide()}c.select(c.selectedIndex);break;case k.UP:c.moveUp();break;case k.DOWN:c.moveDown();break;default:return}d.stopImmediatePropagation(),d.preventDefault()}},onKeyUp:function(d){var c=this;if(!c.disabled){switch(d.which){case k.UP:case k.DOWN:return}clearTimeout(c.onChangeTimeout),c.currentValue!==c.el.val()&&(c.findBestHint(),c.options.deferRequestBy>0?c.onChangeTimeout=setTimeout(function(){c.onValueChange()},c.options.deferRequestBy):c.onValueChange())}},onValueChange:function(){var a=this,h=a.options,g=a.el.val(),f=a.getQuery(g);return a.selection&&a.currentValue!==f&&(a.selection=null,(h.onInvalidateSelection||r.noop).call(a.element)),clearTimeout(a.onChangeTimeout),a.currentValue=g,a.selectedIndex=-1,h.triggerSelectOnValidInput&&a.isExactMatch(f)?void a.select(0):void (f.length<h.minChars?a.hide():a.getSuggestions(f))},isExactMatch:function(d){var c=this.suggestions;return 1===c.length&&c[0].value.toLowerCase()===d.toLowerCase()},getQuery:function(a){var f,e=this.options.delimiter;return e?(f=a.split(e),r.trim(f[f.length-1])):a},getSuggestionsLocal:function(a){var w,v=this,u=v.options,t=a.toLowerCase(),s=u.lookupFilter,i=parseInt(u.lookupLimit,10);return w={suggestions:r.grep(u.lookup,function(b){return s(b,a,t)})},i&&w.suggestions.length>i&&(w.suggestions=w.suggestions.slice(0,i)),w},getSuggestions:function(a){var y,x,w,v,u=this,t=u.options,s=t.serviceUrl;if(t.params[t.paramName]=a,t.onSearchStart.call(u.element,t.params)!==!1){if(x=t.ignoreParams?null:t.params,r.isFunction(t.lookup)){return void t.lookup(a,function(b){u.suggestions=b.suggestions,u.suggest(),t.onSearchComplete.call(u.element,a,b.suggestions)})}u.isLocal?y=u.getSuggestionsLocal(a):(r.isFunction(s)&&(s=s.call(u.element,a)),w=s+"?"+r.param(x||{}),y=u.cachedResponse[w]),y&&r.isArray(y.suggestions)?(u.suggestions=y.suggestions,u.suggest(),t.onSearchComplete.call(u.element,a,y.suggestions)):u.isBadQuery(a)?t.onSearchComplete.call(u.element,a,[]):(u.abortAjax(),v={url:s,data:x,type:t.type,dataType:t.dataType},r.extend(v,t.ajaxSettings),u.currentRequest=r.ajax(v).done(function(b){var d;u.currentRequest=null,d=t.transformResult(b,a),u.processResponse(d,a,w),t.onSearchComplete.call(u.element,a,d.suggestions)}).fail(function(b,f,e){t.onSearchError.call(u.element,a,b,f,e)}))}},isBadQuery:function(e){if(!this.options.preventBadQueries){return !1}for(var d=this.badQueries,f=d.length;f--;){if(0===e.indexOf(d[f])){return !0}}return !1},hide:function(){var a=this,d=r(a.suggestionsContainer);r.isFunction(a.options.onHide)&&a.visible&&a.options.onHide.call(a.element,d),a.visible=!1,a.selectedIndex=-1,clearTimeout(a.onChangeTimeout),r(a.suggestionsContainer).hide(),a.signalHint(null)},suggest:function(){if(!this.suggestions.length){return void (this.options.showNoSuggestionNotice?this.noSuggestions():this.hide())}var D,C=this,B=C.options,A=B.groupBy,z=B.formatResult,y=C.getQuery(C.currentValue),x=C.classes.suggestion,w=C.classes.selected,v=r(C.suggestionsContainer),u=r(C.noSuggestionsContainer),t=B.beforeRender,s="",a=function(b,e){var d=b.data[A];return D===d?"":(D=d,B.formatGroup(b,D))};return B.triggerSelectOnValidInput&&C.isExactMatch(y)?void C.select(0):(r.each(C.suggestions,function(d,c){A&&(s+=a(c,y,d)),s+='<div class="'+x+'" data-index="'+d+'">'+z(c,y,d)+"</div>"}),this.adjustContainerWidth(),u.detach(),v.html(s),r.isFunction(t)&&t.call(C.element,v,C.suggestions),C.fixPosition(),v.show(),B.autoSelectFirst&&(C.selectedIndex=0,v.scrollTop(0),v.children("."+x).first().addClass(w)),C.visible=!0,void C.findBestHint())},noSuggestions:function(){var a=this,h=a.options.beforeRender,g=r(a.suggestionsContainer),f=r(a.noSuggestionsContainer);this.adjustContainerWidth(),f.detach(),g.empty(),g.append(f),r.isFunction(h)&&h.call(a.element,g,a.suggestions),a.fixPosition(),g.show(),a.visible=!0},adjustContainerWidth:function(){var a,h=this,g=h.options,f=r(h.suggestionsContainer);"auto"===g.width?(a=h.el.outerWidth(),f.css("width",a>0?a:300)):"flex"===g.width&&f.css("width","")},findBestHint:function(){var a=this,f=a.el.val().toLowerCase(),e=null;f&&(r.each(a.suggestions,function(d,c){var g=0===c.value.toLowerCase().indexOf(f);return g&&(e=c),!g}),a.signalHint(e))},signalHint:function(a){var f="",e=this;a&&(f=e.currentValue+a.value.substr(e.currentValue.length)),e.hintValue!==f&&(e.hintValue=f,e.hint=a,(this.options.onHint||r.noop)(f))},verifySuggestionsFormat:function(a){return a.length&&"string"==typeof a[0]?r.map(a,function(b){return{value:b,data:null}}):a},validateOrientation:function(a,d){return a=r.trim(a||"").toLowerCase(),-1===r.inArray(a,["auto","bottom","top"])&&(a=d),a},processResponse:function(g,f,s){var i=this,h=i.options;g.suggestions=i.verifySuggestionsFormat(g.suggestions),h.noCache||(i.cachedResponse[s]=g,h.preventBadQueries&&!g.suggestions.length&&i.badQueries.push(f)),f===i.getQuery(i.currentValue)&&(i.suggestions=g.suggestions,i.suggest())},activate:function(a){var u,t=this,s=t.classes.selected,i=r(t.suggestionsContainer),h=i.find("."+t.classes.suggestion);return i.find("."+s).removeClass(s),t.selectedIndex=a,-1!==t.selectedIndex&&h.length>t.selectedIndex?(u=h.get(t.selectedIndex),r(u).addClass(s),u):null},selectHint:function(){var a=this,d=r.inArray(a.hint,a.suggestions);a.select(d)},select:function(d){var c=this;c.hide(),c.onSelect(d)},moveUp:function(){var a=this;if(-1!==a.selectedIndex){return 0===a.selectedIndex?(r(a.suggestionsContainer).children().first().removeClass(a.classes.selected),a.selectedIndex=-1,a.el.val(a.currentValue),void a.findBestHint()):void a.adjustScroll(a.selectedIndex-1)}},moveDown:function(){var b=this;b.selectedIndex!==b.suggestions.length-1&&b.adjustScroll(b.selectedIndex+1)},adjustScroll:function(a){var w=this,v=w.activate(a);if(v){var u,t,s,i=r(v).outerHeight();u=v.offsetTop,t=r(w.suggestionsContainer).scrollTop(),s=t+w.options.maxHeight-i,t>u?r(w.suggestionsContainer).scrollTop(u):u>s&&r(w.suggestionsContainer).scrollTop(u-w.options.maxHeight+i),w.options.preserveInput||w.el.val(w.getValue(w.suggestions[a].value)),w.signalHint(null)}},onSelect:function(a){var h=this,g=h.options.onSelect,f=h.suggestions[a];h.currentValue=h.getValue(f.value),h.currentValue===h.el.val()||h.options.preserveInput||h.el.val(h.currentValue),h.signalHint(null),h.suggestions=[],h.selection=f,r.isFunction(g)&&g.call(h.element,f)},getValue:function(g){var f,s,i=this,h=i.options.delimiter;return h?(f=i.currentValue,s=f.split(h),1===s.length?g:f.substr(0,f.length-s[s.length-1].length)+g):g},dispose:function(){var a=this;a.el.off(".autocomplete").removeData("autocomplete"),r(window).off("resize.autocomplete",a.fixPositionCapture),r(a.suggestionsContainer).remove()}},r.fn.devbridgeAutocomplete=function(f,b){var a="autocomplete";return arguments.length?this.each(function(){var d=r(this),c=d.data(a);"string"==typeof f?c&&"function"==typeof c[f]&&c[f](b):(c&&c.dispose&&c.dispose(),c=new q(this,f),d.data(a,c))}):this.first().data(a)},r.fn.autocomplete||(r.fn.autocomplete=r.fn.devbridgeAutocomplete)});