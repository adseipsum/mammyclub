!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;"undefined"!=typeof window?a=window:"undefined"!=typeof global?a=global:"undefined"!=typeof self&&(a=self),a.sbjs=b()}}}(function(){return function a(d,f,g){function e(h,k){if(!f[h]){if(!d[h]){var l="function"==typeof require&&require;if(!k&&l){return l(h,!0)}if(c){return c(h,!0)}var i=new Error("Cannot find module '"+h+"'");throw i.code="MODULE_NOT_FOUND",i}var j=f[h]={exports:{}};d[h][0].call(j.exports,function(n){var m=d[h][1][n];return e(m?m:n)},j,j.exports,a,d,f,g)}return f[h].exports}for(var c="function"==typeof require&&require,b=0;b<g.length;b++){e(g[b])}return e}({1:[function(f,b,d){var g=f("./init"),c={init:function(h){this.get=g(h),h&&h.callback&&"function"==typeof h.callback&&h.callback(this.get)}};b.exports=c},{"./init":6}],2:[function(g,c,f){var h=g("./terms"),d=g("./helpers/utils"),b={containers:{current:"sbjs_current",current_extra:"sbjs_current_add",first:"sbjs_first",first_extra:"sbjs_first_add",session:"sbjs_session",udata:"sbjs_udata",promocode:"sbjs_promo"},service:{migrations:"sbjs_migrations"},delimiter:"|||",aliases:{main:{type:"typ",source:"src",medium:"mdm",campaign:"cmp",content:"cnt",term:"trm"},extra:{fire_date:"fd",entrance_point:"ep",referer:"rf"},session:{pages_seen:"pgs",current_page:"cpg"},udata:{visits:"vst",ip:"uip",agent:"uag"},promo:"code"},pack:{main:function(i){return b.aliases.main.type+"="+i.type+b.delimiter+b.aliases.main.source+"="+i.source+b.delimiter+b.aliases.main.medium+"="+i.medium+b.delimiter+b.aliases.main.campaign+"="+i.campaign+b.delimiter+b.aliases.main.content+"="+i.content+b.delimiter+b.aliases.main.term+"="+i.term},extra:function(i){return b.aliases.extra.fire_date+"="+d.setDate(new Date,i)+b.delimiter+b.aliases.extra.entrance_point+"="+document.location.href+b.delimiter+b.aliases.extra.referer+"="+(document.referrer||h.none)},user:function(j,i){return b.aliases.udata.visits+"="+j+b.delimiter+b.aliases.udata.ip+"="+i+b.delimiter+b.aliases.udata.agent+"="+navigator.userAgent},session:function(i){return b.aliases.session.pages_seen+"="+i+b.delimiter+b.aliases.session.current_page+"="+document.location.href},promo:function(i){return b.aliases.promo+"="+d.setLeadingZeroToInt(d.randomInt(i.min,i.max),i.max.toString().length)}}};c.exports=b},{"./helpers/utils":5,"./terms":9}],3:[function(d,b,c){var f=d("../data").delimiter;b.exports={encodeData:function(g){return encodeURIComponent(g).replace(/\!/g,"%21").replace(/\~/g,"%7E").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},decodeData:function(i){try{return decodeURIComponent(i).replace(/\%21/g,"!").replace(/\%7E/g,"~").replace(/\%2A/g,"*").replace(/\%27/g,"'").replace(/\%28/g,"(").replace(/\%29/g,")")}catch(g){try{return unescape(i)}catch(h){return""}}},set:function(m,j,l,q,k){var h,g;if(l){var p=new Date;p.setTime(p.getTime()+60*l*1000),h="; expires="+p.toGMTString()}else{h=""}g=q&&!k?";domain=."+q:"",document.cookie=this.encodeData(m)+"="+this.encodeData(j)+h+g+"; path=/"},get:function(j){for(var g=this.encodeData(j)+"=",i=document.cookie.split(";"),k=0;k<i.length;k++){for(var h=i[k];" "===h.charAt(0);){h=h.substring(1,h.length)}if(0===h.indexOf(g)){return this.decodeData(h.substring(g.length,h.length))}}return null},destroy:function(i,g,h){this.set(i,"",-1,g,h)},parse:function(k){var p=[],g={};if("string"==typeof k){p.push(k)}else{for(var q in k){k.hasOwnProperty(q)&&p.push(k[q])}}for(var j=0;j<p.length;j++){var m;g[this.unsbjs(p[j])]={},m=this.get(p[j])?this.get(p[j]).split(f):[];for(var h=0;h<m.length;h++){var l=m[h].split("="),n=l.splice(0,1);n.push(l.join("=")),g[this.unsbjs(p[j])][n[0]]=this.decodeData(n[1])}}return g},unsbjs:function(g){return g.replace("sbjs_","")}}},{"../data":2}],4:[function(d,b,c){b.exports={parse:function(i){for(var f=this.parseOptions,h=f.parser[f.strictMode?"strict":"loose"].exec(i),j={},g=14;g--;){j[f.key[g]]=h[g]||""}return j[f.q.name]={},j[f.key[12]].replace(f.q.parser,function(m,l,k){l&&(j[f.q.name][l]=k)}),j},parseOptions:{strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},getParam:function(l){for(var h={},k=l?l:window.location.search.substring(1),m=k.split("&"),j=0;j<m.length;j++){var g=m[j].split("=");if("undefined"==typeof h[g[0]]){h[g[0]]=g[1]}else{if("string"==typeof h[g[0]]){var f=[h[g[0]],g[1]];h[g[0]]=f}else{h[g[0]].push(g[1])}}}return h},getHost:function(f){return this.parse(f).host.replace("www.","")}}},{}],5:[function(d,b,c){b.exports={escapeRegexp:function(f){return f.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},setDate:function(l,w){var f=l.getTimezoneOffset()/60,j=l.getHours(),x=w||0===w?w:-f;l.setHours(j+f+x);var k=l.getFullYear(),q=this.setLeadingZeroToInt(l.getMonth()+1,2),h=this.setLeadingZeroToInt(l.getDate(),2),m=this.setLeadingZeroToInt(l.getHours(),2),v=this.setLeadingZeroToInt(l.getMinutes(),2),g=this.setLeadingZeroToInt(l.getSeconds(),2);return k+"-"+q+"-"+h+" "+m+":"+v+":"+g},setLeadingZeroToInt:function(h,f){for(var g=h+"";g.length<f;){g="0"+g}return g},randomInt:function(g,f){return Math.floor(Math.random()*(f-g+1))+g}}},{}],6:[function(h,m,b){var f=h("./data"),p=h("./terms"),g=h("./helpers/cookies"),k=h("./helpers/uri"),d=h("./helpers/utils"),j=h("./params"),l=h("./migrations");m.exports=function(K){function u(){var q;if("undefined"!=typeof c.utm_source||"undefined"!=typeof c.utm_medium||"undefined"!=typeof c.utm_campaign||"undefined"!=typeof c.utm_content||"undefined"!=typeof c.utm_term||"undefined"!=typeof c.gclid||"undefined"!=typeof c.yclid||"undefined"!=typeof c[G.campaign_param]){H(),q=z(p.traffic.utm)}else{if(J(p.traffic.organic)){H(),q=z(p.traffic.organic)}else{if(!g.get(f.containers.session)&&J(p.traffic.referral)){H(),q=z(p.traffic.referral)}else{if(g.get(f.containers.first)||g.get(f.containers.current)){return g.get(f.containers.current)}H(),q=z(p.traffic.typein)}}}return q}function z(r){switch(r){case p.traffic.utm:M=p.traffic.utm,E="undefined"!=typeof c.utm_source?c.utm_source:"undefined"!=typeof c.gclid?"google":"undefined"!=typeof c.yclid?"yandex":p.none,o="undefined"!=typeof c.utm_medium?c.utm_medium:"undefined"!=typeof c.gclid?"cpc":"undefined"!=typeof c.yclid?"cpc":p.none,A="undefined"!=typeof c.utm_campaign?c.utm_campaign:"undefined"!=typeof c[G.campaign_param]?c[G.campaign_param]:"undefined"!=typeof c.gclid?"google_cpc":"undefined"!=typeof c.yclid?"yandex_cpc":p.none,i=c.utm_content||p.none,F=B()||p.none;break;case p.traffic.organic:M=p.traffic.organic,E=E||k.getHost(document.referrer),o=p.referer.organic,A=p.none,i=p.none,F=p.none;break;case p.traffic.referral:M=p.traffic.referral,E=E||k.getHost(document.referrer),o=o||p.referer.referral,A=p.none,i=k.parse(document.referrer).path,F=p.none;break;case p.traffic.typein:M=p.traffic.typein,E=G.typein_attributes.source,o=G.typein_attributes.medium,A=p.none,i=p.none,F=p.none;break;default:M=p.oops,E=p.oops,o=p.oops,A=p.oops,i=p.oops,F=p.oops}var q={type:M,source:E,medium:o,campaign:A,content:i,term:F};return f.pack.main(q)}function B(){var r=document.referrer;if(c.utm_term){return c.utm_term}if(!(r&&k.parse(r).host&&k.parse(r).host.match(/^(?:.*\.)?yandex\..{2,9}$/i))){return !1}try{return k.getParam(k.parse(document.referrer).query).text}catch(q){return !1}}function J(r){var q=document.referrer;switch(r){case p.traffic.organic:return !!q&&D(q)&&C(q);case p.traffic.referral:return !!q&&D(q)&&L(q);default:return !1}}function D(r){if(G.domain){if(N){return k.getHost(r)!==k.getHost(s)}var q=new RegExp("^(?:.*\\.)?"+d.escapeRegexp(s)+"$","i");return !k.getHost(r).match(q)}return k.getHost(r)!==k.getHost(document.location.href)}function C(I){var w="yandex",y="text",P="google",x=new RegExp("^(?:.*\\.)?"+d.escapeRegexp(w)+"\\..{2,9}$"),v=new RegExp(".*"+d.escapeRegexp(y)+"=.*"),O=new RegExp("^(?:www\\.)?"+d.escapeRegexp(P)+"\\..{2,9}$");if(k.parse(I).query&&k.parse(I).host.match(x)&&k.parse(I).query.match(v)){return E=w,!0}if(k.parse(I).host.match(O)){return E=P,!0}if(!k.parse(I).query){return !1}for(var q=0;q<G.organics.length;q++){if(k.parse(I).host.match(new RegExp("^(?:.*\\.)?"+d.escapeRegexp(G.organics[q].host)+"$","i"))&&k.parse(I).query.match(new RegExp(".*"+d.escapeRegexp(G.organics[q].param)+"=.*","i"))){return E=G.organics[q].display||G.organics[q].host,!0}if(q+1===G.organics.length){return !1}}}function L(r){if(!(G.referrals.length>0)){return E=k.getHost(r),!0}for(var q=0;q<G.referrals.length;q++){if(k.parse(r).host.match(new RegExp("^(?:.*\\.)?"+d.escapeRegexp(G.referrals[q].host)+"$","i"))){return E=G.referrals[q].display||G.referrals[q].host,o=G.referrals[q].medium||p.referer.referral,!0}if(q+1===G.referrals.length){return E=k.getHost(r),!0}}}function H(){g.set(f.containers.current_extra,f.pack.extra(G.timezone_offset),n,s,N),g.get(f.containers.first_extra)||g.set(f.containers.first_extra,f.pack.extra(G.timezone_offset),n,s,N)}var G=j.fetch(K),c=k.getParam(),s=G.domain.host,N=G.domain.isolate,n=G.lifetime;l.go(n,s,N);var M,E,o,A,i,F;return function(){g.set(f.containers.current,u(),n,s,N),g.get(f.containers.first)||g.set(f.containers.first,g.get(f.containers.current),n,s,N);var v,t;g.get(f.containers.udata)?(v=parseInt(g.parse(f.containers.udata)[g.unsbjs(f.containers.udata)][f.aliases.udata.visits])||1,v=g.get(f.containers.session)?v:v+1,t=f.pack.user(v,G.user_ip)):(v=1,t=f.pack.user(v,G.user_ip)),g.set(f.containers.udata,t,n,s,N);var q;g.get(f.containers.session)?(q=parseInt(g.parse(f.containers.session)[g.unsbjs(f.containers.session)][f.aliases.session.pages_seen])||1,q+=1):q=1,g.set(f.containers.session,f.pack.session(q),G.session_length,s,N),G.promocode&&!g.get(f.containers.promocode)&&g.set(f.containers.promocode,f.pack.promo(G.promocode),n,s,N)}(),g.parse(f.containers)}},{"./data":2,"./helpers/cookies":3,"./helpers/uri":4,"./helpers/utils":5,"./migrations":7,"./params":8,"./terms":9}],7:[function(f,b,d){var g=f("./data"),c=f("./helpers/cookies");b.exports={go:function(n,l,m){var k,h=this.migrations,p={l:n,d:l,i:m};if(c.get(g.containers.first)||c.get(g.service.migrations)){if(!c.get(g.service.migrations)){for(k=0;k<h.length;k++){h[k].go(h[k].id,p)}}}else{var q=[];for(k=0;k<h.length;k++){q.push(h[k].id)}var j="";for(k=0;k<q.length;k++){j+=q[k]+"=1",k<q.length-1&&(j+=g.delimiter)}c.set(g.service.migrations,j,p.l,p.d,p.i)}},migrations:[{id:"1418474375998",version:"1.0.0-beta",go:function(n,w){var h=n+"=1",l=n+"=0",s=function(p,i,o){return i||o?p:g.delimiter};try{var k=[];for(var q in g.containers){g.containers.hasOwnProperty(q)&&k.push(g.containers[q])}for(var v=0;v<k.length;v++){if(c.get(k[v])){var j=c.get(k[v]).replace(/(\|)?\|(\|)?/g,s);c.destroy(k[v],w.d,w.i),c.destroy(k[v],w.d,!w.i),c.set(k[v],j,w.l,w.d,w.i)}}c.get(g.containers.session)&&c.set(g.containers.session,g.pack.session(0),w.l,w.d,w.i),c.set(g.service.migrations,h,w.l,w.d,w.i)}catch(m){c.set(g.service.migrations,l,w.l,w.d,w.i)}}}]}},{"./data":2,"./helpers/cookies":3}],8:[function(f,b,d){var g=f("./terms"),c=f("./helpers/uri");b.exports={fetch:function(m){var k=m||{},l={};if(l.lifetime=this.validate.checkFloat(k.lifetime)||6,l.lifetime=parseInt(30*l.lifetime*24*60),l.session_length=this.validate.checkInt(k.session_length)||30,l.timezone_offset=this.validate.checkInt(k.timezone_offset),l.campaign_param=k.campaign_param||!1,l.user_ip=k.user_ip||g.none,k.promocode?(l.promocode={},l.promocode.min=parseInt(k.promocode.min)||100000,l.promocode.max=parseInt(k.promocode.max)||999999):l.promocode=!1,k.typein_attributes&&k.typein_attributes.source&&k.typein_attributes.medium?(l.typein_attributes={},l.typein_attributes.source=k.typein_attributes.source,l.typein_attributes.medium=k.typein_attributes.medium):l.typein_attributes={source:"(direct)",medium:"(none)"},k.domain&&this.validate.isString(k.domain)?l.domain={host:k.domain,isolate:!1}:k.domain&&k.domain.host?l.domain=k.domain:l.domain={host:c.getHost(document.location.hostname),isolate:!1},l.referrals=[],k.referrals&&k.referrals.length>0){for(var j=0;j<k.referrals.length;j++){k.referrals[j].host&&l.referrals.push(k.referrals[j])}}if(l.organics=[],k.organics&&k.organics.length>0){for(var h=0;h<k.organics.length;h++){k.organics[h].host&&k.organics[h].param&&l.organics.push(k.organics[h])}}return l.organics.push({host:"bing.com",param:"q",display:"bing"}),l.organics.push({host:"yahoo.com",param:"p",display:"yahoo"}),l.organics.push({host:"about.com",param:"q",display:"about"}),l.organics.push({host:"aol.com",param:"q",display:"aol"}),l.organics.push({host:"ask.com",param:"q",display:"ask"}),l.organics.push({host:"globososo.com",param:"q",display:"globo"}),l.organics.push({host:"go.mail.ru",param:"q",display:"go.mail.ru"}),l.organics.push({host:"rambler.ru",param:"query",display:"rambler"}),l.organics.push({host:"tut.by",param:"query",display:"tut.by"}),l.referrals.push({host:"t.co",display:"twitter.com"}),l.referrals.push({host:"plus.url.google.com",display:"plus.google.com"}),l},validate:{checkFloat:function(h){return h&&this.isNumeric(parseFloat(h))?parseFloat(h):!1},checkInt:function(h){return h&&this.isNumeric(parseInt(h))?parseInt(h):!1},isNumeric:function(h){return !isNaN(h)},isString:function(h){return"[object String]"===Object.prototype.toString.call(h)}}}},{"./helpers/uri":4,"./terms":9}],9:[function(d,b,c){b.exports={traffic:{utm:"utm",organic:"organic",referral:"referral",typein:"typein"},referer:{referral:"referral",organic:"organic",social:"social"},none:"(none)",oops:"(Houston, we have a problem)"}},{}]},{},[1])(1)});