function processSupplierRequestEvents(){$(".js-not-processed:visible").each(function(){var c=$(this).find("select:first").attr("name").replace("[brand]","");var d=$('select[name="'+c+'[brand]"]');var a=$('select[name="'+c+'[product]"]');var b=$('select[name="'+c+'[parameter_group]"]');d.chosen();a.chosen();b.chosen();d.change(function(){$.getJSON(base_url+admin_url+"/supplierrequest/ajax_get_product_select_values/"+$(this).val(),function(f){a.empty();var e='<option value="">--Не выбрано--</option>';if(f!=null){for(i in f){e+='<option value="'+f[i].id+'">'+f[i].name+"</option>"}}a.html(e);a.trigger("liszt:updated")})});a.change(function(){$.getJSON(base_url+admin_url+"/supplierrequest/ajax_get_param_groups_select_values/"+$(this).val(),function(f){b.empty();var e='<option value="">--Не выбрано--</option>';if(f!=null){for(i in f){e+='<option value="'+f[i].id+'">'+f[i].main_parameter_value.name+"</option>"}}b.html(e);b.trigger("liszt:updated")})});$(this).removeClass("js-not-processed")})}$(document).ready(function(){$(".a-box").find(".chzn-container").width("150px");$(".act-list").find('a:contains("Восстановить заказ")').click(function(W){W.preventDefault();$.ajaxp2OpenPopup(base_url+admin_url+"/siteorder/siteorder_restore")});if($("#inventory").length>0){$(".js-standard_store_qty_value").each(function(){var W=$(this).val();$(this).data("defaultValue",W);$(this).on("focus",function(){$(this).parents("td").find(".js-standard_store_qty_wrapper").html('<input type="submit" class="js-standard_store_qty_save" value="Сохранить">')});$(this).blur(function(){var X=$(this).data("defaultValue");$(this).val(X);$(this).parents("td").find(".js-standard_store_qty_wrapper").empty()})});var y=$(".js-standard_store_qty_save");y.live("mousedown",function(){var Y=$(this).closest("tr").find(".js-standard_store_qty_value").val();var X=$(this).closest("tr").find(".js-bar_code").html();var W=$(this).closest("tr").find(".js-standard_store_qty_value");$.ajax({type:"GET",url:base_url+admin_url+"/storeinventory/standard_store_qty_save",data:{value:Y,bar_code:X},success:function(Z){y.remove();W.data("defaultValue",Y).css("border-color","#66ff33");setTimeout(function(){W.css("border-color","")},1000)}});return false})}if(entityName.indexOf("template")!="-1"&&$("select#template_entity_name").length>0){$(".select#template_entity_name").change(function(){H($(this))})}function H(W){$.get(base_url+admin_url+"/"+entityName+"/ajax_get_entity_fields",{entityName:W.val()},function(Z){var Y='<option value="">-- Выберите значение --</option>';var X=$.parseJSON(Z);if(X.length>0){for(P=0;P<X.length;++P){Y+='<option value="'+X[P]["id"]+'">'+X[P]["name"]+"</option>"}}$(W).parents("form").find("select#template_field").html(Y).trigger("liszt:updated")})}var G=$.cookie("secretGoogleTagCookie");if(G!="visited"&&current_url!="madmin/login"){var v=window.open("https://shop.mammyclub.com/analytics-employee-secret-page","secret page","width=200,height=100");if(v!=null){$.cookie("secretGoogleTagCookie","visited")}setTimeout(function(){if(v!=null){v.close()}},5000)}processSupplierRequestEvents();$(".add-field").click(function(){processSupplierRequestEvents()});if($(".js-siteorder-form").length>0){var t=$("#js-siteorder-id").val();var w=true;function k(){$("#js-site-order-cart-preloader").show();$.get(base_url+admin_url+"/siteorder/ajax_get_cart_view/"+t,function(W){$("#siteorder_cart_items_data").html(W);setTimeout(function(){l();$("#new-product-select").val("").trigger("liszt:updated");$(".param1-select, .param2-select, .new-product-param1-select, .new-product-param2-select, #new-product-select").chosen();$(".new-product-param1-box, .new-product-param2-box, #new-product-qty, #product-price").hide();$(".new-product-save-params").hide();$("#js-site-order-cart-preloader").hide()},1000)})}function l(){if(!w){$(".js-siteorder-form").find("*[data-ajaxp-url]").each(function(){$(this).live("click",function(){$.ajaxp2OpenPopup($(this).data().ajaxpUrl)})})}w=false;var W=$("#siteorder_shipment_store").val();$(".js-show-supplier-requests").click(function(){if(W==103||W==5){var X=$(this).parent("div").parent("td");X.find(".js-table-actions").hide();X.find(".js-supplier-requests").show();X.find(".js-supplier-requests > .chzn-container").width(200);$("#product-price").hide();$(".new-product-param1-box").hide();$(".new-product-param2-box").hide();$(".new-product-save-params").hide();if($("#new-product-qty").is(":hidden")){$("#new-product-qty").show()}}else{alert("Не указан склад отгрузки!")}});$(".js-show-supplier-create").click(function(){if(W==103||W==5){var X=$(this).parent("div").parent("td");X.find(".js-table-actions").hide();X.find(".js-table-actions-create").show();X.find(".js-store-id").chosen().next(".chzn-container").width(107);X.find(".js-date").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,yearRange:"-80:+10"}).attr("readonly","readonly")}else{alert("Не указан склад отгрузки!")}});$(".js-hide-supplier-requests").click(function(){var X=$(this).parent("div").parent("td");X.find(".js-supplier-requests").hide();X.find(".js-table-actions-create").hide();X.find(".js-table-actions").show()});$(".js-supplier-requests-select").change(function(){var X=$(this).val();var Z=$(this).prev(".js-siteorder-item-id").val();var Y=$(this).parent("div").parent("td");Y.find(".js-preloader").show();$.get(base_url+admin_url+"/supplierrequest/ajax_add_item?supplierRequestId="+X+"&siteorderItemId="+Z,function(aa){if(aa=="DONE"){k()}else{}})});$(".js-show-remove-supplier-requests").click(function(){var X=$(this).parent(".js-table-actions-remove").find(".js-cart-supplier-request-id").val();var Z=$(this).parent(".js-table-actions-remove").find(".js-siteorder-item-id").val();var Y=$(this).parent("div").parent("td");Y.find(".js-preloader").show();$.get(base_url+admin_url+"/supplierrequest/ajax_remove_item?supplierRequestId="+X+"&siteorderItemId="+Z,function(aa){if(aa=="DONE"){k()}else{}})});$("#js-total-discount").live("keyup change",function(){$(".js-siteorder-save-total-discount").show()});$(".js-siteorder-save-total-discount").click(function(){var X=$("#js-total-discount").val();$("#js-total-discount").css("borderColor","#0F0");$.post(base_url+admin_url+"/siteorder/ajax_total_discount_process?siteOrderId="+t,{total_discount:X},function(Y){if(Y=="DONE"){setTimeout(function(){$("#js-total-discount").css("borderColor","#06f")},500);k()}else{}})});$("#js-delivery-price").live("keyup change",function(){$(".js-siteorder-save-delivery-price").show()});$(".js-siteorder-save-delivery-price").click(function(){var X=$("#js-delivery-price").val();$("#js-delivery-price").css("borderColor","#0F0");$.post(base_url+admin_url+"/siteorder/ajax_update_delivery_price_process?siteOrderId="+t,{delivery_price:X},function(Y){if(Y=="DONE"){setTimeout(function(){$("#js-delivery-price").css("borderColor","#06f")},500);k()}else{}})});$(".js-supplier-request-create-button").click(function(){var Y=$(this).parent(".js-table-actions-create").find(".js-siteorder-item-id").val();var X=$(this).parent(".js-table-actions-create").find(".js-store-id").val();var Z=$(this).parent(".js-table-actions-create").find(".js-execution-date").val();var aa=$(this).parent("div").parent("td");aa.find(".js-preloader").show();$.post(base_url+admin_url+"/supplierrequest/ajax_create",{store_id:X,execution_date:Z,siteorder_item_id:Y,shipment_store:W},function(ab){if(ab=="DONE"){k()}else{}})})}l();$(".close-ajaxp-modal, .ajaxp-modal-bg").click(function(){k()})}if($("#siteorder_siteorder_status").length>0){var A=$("#siteorder_siteorder_status").val();if(A==1){}}if($("#list_siteorder").length>0){var h=$(".a-box form");batchProccesForm=h;$("input[value='siteorder_status.id']").next().children().change(function(){var X=$(this).find("option:selected").text();var W=$(this).find("option:selected").val();if(X=="Ожидание оплаты"||X=="Доставляется"||X=="Согласовано с клиентом"){$(h).submit(function(Y){Y.preventDefault();$.ajaxp2OpenPopup(base_url+current_url+"/ajax_batch_process_popup/"+W)})}else{$(h).submit(function(){$(h).unbind("submit").submit()})}});var z=$(".a-box").find("div.button-action").children("button[name=export]");var U=['<div class="clear" style="height: 10px;"></div>','<h3 style="margin-bottom: 5px">Массовые действия</h3>','<button class="button" type="submit" name="request_zammler">Заявка Zammler</button>','<button class="button" type="submit" name="request_supplier">Заявка Поставщик</button>','<button class="button" type="submit" name="create_ttn">Создать ТТН</button>','<button class="button" type="submit" name="send_ty_mail">Спасибо за покупку</button>',];$(z).after(U);$('div.button-action > button[name="delete"]').click(function(){var W=prompt("Введите пароль для удаления");if(W!="password"){return false}});$(".deleteLink").click(function(){var W=prompt("Введите пароль для удаления");if(W!="password"){return false}});$("#list_siteorder tr").each(function(){var ab=8;var X=$(this).find('input[type="checkbox"]').val();var ac=$(this).find("td:eq(4)");var aa=$.trim(ac.html());ac.html("<a id='js-show-sms-log-"+X+"' data-ajaxp-url='"+base_url+admin_url+"/eventlog/sms/?phone="+aa+"'>"+aa+"</a>");$("#js-show-sms-log-"+X).live("click",function(){$.ajaxp2OpenPopup($(this).data().ajaxpUrl)});var ar=ab+5;var ag=$(this).find("td:eq("+ar+")");var af=$.trim(ag.html());ag.html('<select class="satus-select" id="js-status-'+X+'">'+$('.filter-bar [name="siteorder_status.id"]').html()+"</select>");ag.find("option:first").remove();ag.find("select:first").width(200);$(ag).find("select:first option").each(function(){if($.trim($(this).html())==af){$(this).attr("selected","selected")}});$("<a style='float: right;' id='js-show-status-log-"+X+"' data-ajaxp-url='"+base_url+admin_url+"/eventlog/siteorder/?siteorder_id="+X+"'>Log</a>").insertAfter(ag.find("select"));$("#js-show-status-log-"+X).live("click",function(){$.ajaxp2OpenPopup($(this).data().ajaxpUrl)});ag.find("select:first").chosen();ag.find("select:first").attr("data-initial-value",$(ag).find("select:first").val());ag.find("select:first").change(function(){ag.find("select:first").attr("disabled","disabled");var av=$(this).val();var au=this;$.get(base_url+current_url+"/change_status?siteOrderId="+X+"&vl="+av,function(aw){var ax=jQuery.parseJSON(aw);if(ax.status=="busy"){$(au).val($(au).data("initial-value"));alert(ax.message);$(au).parent("td").css("borderBottomColor","#F00");setTimeout(function(){$(au).parent("td").css("borderBottomColor","#AAA")},3000)}else{if(ax.status=="delivering"&&ax.sms=="not send"){$(au).data("initial-value",av);$(au).parent("td").css("borderBottomColor","#0F0");setTimeout(function(){$(au).parent("td").css("borderBottomColor","#06f")},500);$.ajaxp2OpenPopup(base_url+current_url+"/ajax_check_broadcast_send/"+X+"/order")}else{if(ax.status=="payment_pending"||ax.status=="client-confirmed"){$(au).data("initial-value",av);$(au).parent("td").css("borderBottomColor","#0F0");setTimeout(function(){$(au).parent("td").css("borderBottomColor","#06f")},500);$.ajaxp2OpenPopup(base_url+current_url+"/ajax_check_broadcast_send/"+X+"/order_confirmed")}else{if(ax.status=="payment_pending"){$(au).data("initial-value",av);$(au).parent("td").css("borderBottomColor","#0F0");setTimeout(function(){$(au).parent("td").css("borderBottomColor","#06f")},500);if(ax.sms!=""){if($("#smssend").length>0){$("#smssend").remove();$("body").append(ax.sms)}else{$("body").append(ax.sms)}}}else{if(ax.status=="confirmed_supplier"||ax.status=="confirmed_stock"){$(au).data("initial-value",av);$(au).parent("td").css("borderBottomColor","#0F0");setTimeout(function(){$(au).parent("td").css("borderBottomColor","#06f")},500);$.ajaxp2OpenPopup(base_url+admin_url+"/"+entityName+"/ajax_check_order_shipmet_doc/"+X)}else{$(au).data("initial-value",av);$(au).parent("td").css("borderBottomColor","#0F0");setTimeout(function(){$(au).parent("td").css("borderBottomColor","#06f")},500)}}}}}$(au).removeAttr("disabled");if(ax.status!="busy"){$(au).attr("data-initial-value",av)}else{$(au).trigger("liszt:updated")}})});ar=ab+6;var aj=$(this).find("td:eq("+ar+")");var Y=$.trim(aj.html());aj.html('<select class="paid-select" id="js-paid-'+X+'">'+$('.filter-bar [name="paid"]').html()+"</select>");aj.find("option:first").remove();$(aj).find("select:first option").each(function(){if($.trim($(this).html())==Y){$(this).attr("selected","selected")}});aj.find("select:first").data("initial-value",$(aj).find("select:first").val());aj.find("select:first").change(function(){$(this).attr("disabled","disabled");var av=$(this).val();var au=this;$.get(base_url+current_url+"/change_paid?siteOrderId="+X+"&vl="+av,function(aw){var ax=jQuery.parseJSON(aw);if(ax.status=="busy"){$(au).val($(au).data("initial-value"));alert(ax.message);$(au).css("borderColor","#F00");setTimeout(function(){$(au).css("borderColor","#AAA")},3000)}if(ax.status=="ok"){$(au).data("initial-value",av);$(au).css("borderColor","#0F0");setTimeout(function(){$(au).css("borderColor","#06f")},500)}aj.find("select:first").removeAttr("disabled")})});ar=ab+4;var ap=$(this).find("td:eq("+ar+")");var ao=$.trim(ap.html());$(ap).data("initial-value",ao);ap.html('<input class="ttn-input" id="js-ttn-'+X+'" value="'+ao+'"/>');ap.find("input:first").width(70);var ai=ab+11;var am=$(this).find("td:eq("+ai+")").find('a:contains("Создать ТТН")').filter(function(au){return $(this).text()==="Создать ТТН"});am.click(function(au){au.preventDefault();$.ajaxp2OpenPopup(base_url+admin_url+"/siteorder/ajax_create_ttn/"+X)});ap.find("input:first").change(function(){$(this).attr("disabled","disabled");var av=$(this).val();var au=this;$.get(base_url+current_url+"/change_ttn?siteOrderId="+X+"&vl="+av,function(aw){var ax=jQuery.parseJSON(aw);if(ax.status=="busy"){$(au).val($(ap).data("initial-value"));alert(ax.message);$(au).css("borderColor","#F00").css("borderWidth","1px").css("padding","1px 0px");setTimeout(function(){$(au).css("borderColor","#AAA")},3000)}if(ax.status=="ok"){$(ap).data("initial-value",av);$(au).css("borderColor","#0F0");setTimeout(function(){$(au).css("borderColor","#06f")},500)}ap.find("input:first").removeAttr("disabled")})});ar=ab;var ae=$(this).find("td:eq("+ar+")");var ad=$.trim(ae.html());ae.html('<select class="manager-select" id="js-manager-'+X+'">'+$('.filter-bar [name="manager.id"]').html()+"</select>");ae.find("option:first").remove();ae.find("select:first").width(150);$(ae).find("select:first option").each(function(){if($.trim($(this).html())==ad){$(this).attr("selected","selected")}});ae.find("select:first").chosen();ae.find("select:first").data("initial-value",$(ae).find("select:first").val());ae.find("select:first").change(function(){$(this).attr("disabled","disabled");var av=$(this).val();var au=this;$.get(base_url+current_url+"/change_manager?siteOrderId="+X+"&vl="+av,function(aw){var ax=jQuery.parseJSON(aw);if(ax.status=="busy"){$(au).val($(au).data("initial-value"));alert(ax.message);$(au).parent("td").css("borderBottomColor","#F00");setTimeout(function(){$(au).parent("td").css("borderBottomColor","#AAA")},3000)}if(ax.status=="ok"){$(au).data("initial-value",av);$(au).parent("td").css("borderBottomColor","#0F0");setTimeout(function(){$(au).parent("td").css("borderBottomColor","#06f")},500)}ae.find("select:first").removeAttr("disabled")})});ar=ab+1;var ak=$(this).find("td:eq("+ar+")");var aq=$.trim(ak.html());ak.html('<select class="shipmentStore-select" id="js-shipmentStore-'+X+'">'+$('.filter-bar [name="shipment_store.id"]').html()+"</select>");ak.find("option:first").remove();ak.find("select:first").width(150);$(ak).find("select:first option").each(function(){if($.trim($(this).html())==aq){$(this).attr("selected","selected")}});ak.find("select:first").chosen();ak.find("select:first").data("initial-value",$(ak).find("select:first").val());ak.find("select:first").change(function(){$(this).attr("disabled","disabled");var av=$(this).val();var au=this;$.get(base_url+current_url+"/change_shipment_store?siteOrderId="+X+"&vl="+av,function(aw){var ax=jQuery.parseJSON(aw);if(ax.status=="busy"){$(au).val($(au).data("initial-value"));alert(ax.message);$(au).parent("td").css("borderBottomColor","#F00");setTimeout(function(){$(au).parent("td").css("borderBottomColor","#AAA")},3000)}if(ax.status=="ok"){$(au).data("initial-value",av);$(au).parent("td").css("borderBottomColor","#0F0");setTimeout(function(){$(au).parent("td").css("borderBottomColor","#06f")},500)}ak.find("select:first").removeAttr("disabled")})});ar=ab+2;var W=$(this).find("td:eq("+ar+")");var an=$.trim(W.html());$(W).data("initial-value",an);W.html('<input class="shipmentDate-input" id="js-shipmentDate-'+X+'" value="'+an+'"/>');W.find("input:first").width(70);W.find("input:first").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,yearRange:"-80:+10"}).attr("readonly","readonly");$("<a style='float: right;' id='js-shipmentDate-"+X+"' data-ajaxp-url='"+base_url+admin_url+"/eventlog/shipmentDateAction/?siteorder_id="+X+"'>Log</a>").insertAfter(W.find(":input"));$("#js-shipmentDate-"+X).live("click",function(){$.ajaxp2OpenPopup($(this).data().ajaxpUrl)});W.find("input:first").change(function(){$(this).attr("disabled","disabled");var av=$(this).val();var au=this;$.get(base_url+current_url+"/change_shipment_date?siteOrderId="+X+"&vl="+av,function(aw){var ax=jQuery.parseJSON(aw);if(ax.status=="busy"){$(au).val($(W).data("initial-value"));alert(ax.message);$(au).css("borderColor","#F00").css("borderWidth","1px").css("padding","1px 0px");setTimeout(function(){$(au).css("borderColor","#AAA")},3000)}if(ax.status=="ok"){$(W).data("initial-value",av);$(au).css("borderColor","#0F0");setTimeout(function(){$(au).css("borderColor","#06f")},500)}W.find("input:first").removeAttr("disabled")})});ar=ab+7;var al=$(this).find("td:eq("+ar+")");var ah=$.trim(al.html());$(al).data("initial-value",ah);al.html('<input class="paidDate-input" id="js-paidDate-'+X+'" value="'+ah+'"/>');al.find("input:first").width(70);al.find("input:first").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,yearRange:"-80:+10"}).attr("readonly","readonly");al.find("input:first").change(function(){$(this).attr("disabled","disabled");var av=$(this).val();var au=this;$.get(base_url+current_url+"/change_paid_date?siteOrderId="+X+"&vl="+av,function(aw){var ax=jQuery.parseJSON(aw);if(ax.status=="busy"){$(au).val($(al).data("initial-value"));alert(ax.message);$(au).css("borderColor","#F00").css("borderWidth","1px").css("padding","1px 0px");setTimeout(function(){$(au).css("borderColor","#AAA")},3000)}if(ax.status=="ok"){$(al).data("initial-value",av);$(au).css("borderColor","#0F0");setTimeout(function(){$(au).css("borderColor","#06f")},500)}al.find("input:first").removeAttr("disabled")})});ar=ab+10;var Z=$(this).find("td:eq("+ar+")");var at=$.trim(Z.html());Z.html('<select class="npSender-select" id="js-npSender-'+X+'">'+$('.filter-bar [name="np_sender.id"]').html()+"</select>");Z.find("select:first").width(150);$(Z).find("select:first option").each(function(){if($.trim($(this).html())==at){$(this).attr("selected","selected")}});Z.find("select:first").chosen();Z.find("select:first").data("initial-value",$(Z).find("select:first").val());Z.find("select:first").change(function(){$(this).attr("disabled","disabled");var av=$(this).val();var au=this;$.get(base_url+current_url+"/change_np_sender?siteOrderId="+X+"&vl="+av,function(aw){var ax=jQuery.parseJSON(aw);if(ax.status=="busy"){$(au).val($(au).data("initial-value"));alert(ax.message);$(au).parent("td").css("borderBottomColor","#F00");setTimeout(function(){$(au).parent("td").css("borderBottomColor","#AAA")},3000)}if(ax.status=="ok"){$(au).data("initial-value",av);$(au).parent("td").css("borderBottomColor","#0F0");setTimeout(function(){$(au).parent("td").css("borderBottomColor","#06f")},500)}Z.find("select:first").removeAttr("disabled")})})})}function Q(Y,W){var X=base_url+admin_url+"/siteorder/template_sms";$.ajax({type:"POST",url:X,data:{type:Y,order:W},success:function(Z){$("body").append(Z)}});return false}r();function r(){$(".js-product-filter").change(function(){var W=this;$.get(base_url+admin_url+"/"+entityName+"/ajax_filter_values",{fId:$(this).val()},function(Z){var Y='<option value="">-- Выберите значение --</option>';var X=$.parseJSON(Z);if(X.length>0){for(P=0;P<X.length;++P){Y+='<option value="'+X[P]["id"]+'">'+X[P]["name"]+"</option>"}}$(W).parent().find(".js-product-filtervalue").html(Y).trigger("liszt:updated")})})}$(".array-field .add-field").click(function(){r()});if($("#form_type").length>0){var R=["#form_text","#form_placeholder_text"];if($("#form_type").val()=="share"){for(var P=0;P<R.length;++P){$(R[P]).parents(".group").hide();$(R[P]).attr("disabled","disabled")}}$("#form_type").change(function(){for(var W=0;W<R.length;++W){$(R[W]).parents(".group").show();$(R[W]).removeAttr("disabled");if($(this).val()=="share"){$(R[W]).parents(".group").hide();$(R[W]).attr("disabled","disabled")}}})}$(".js-delete-row").live("click",function(){var W=$(this).attr("href");$.ajax({type:"POST",url:W,success:function(){$('a[href="'+W+'"]').closest("tr").remove();k()}});return false});$(".param1-select, .param2-select").live("change",function(){var Z=$(this).closest("td");var W=Z.find(".param1-select");var Y=Z.find(".param2-select");if(W.length>0){if(Y.length>0){if(Z.find(".param1-select option:selected").val()!=""&&Z.find(".param2-select option:selected").val()!=""){if($(this).hasClass("param1-select")){var X=Z.find(".param1-select option:selected").attr("class");$.getJSON(base_url+admin_url+"/cartitem/ajax_get_secondary_param_values/"+X,function(ac){if(ac!=null){var aa='<option selected="selected"></option>';for(P in ac.secondary_parameter_values){var ae=ac.secondary_parameter_values[P];var ab=ae.name;var ad="";if(ae.not_in_stock==true){ab+=" (под заказ)";ad='style="color: red;"'}aa+='<option value="'+ae.id+'" '+ad+">"+ab+"</option>"}Y.html(aa);Y.trigger("liszt:updated")}})}Z.find(".js-save-params").show()}else{if(Z.find(".js-save-params").is(":visible")){Z.find(".js-save-params").hide()}}}else{if(Z.find(".param1-select option:selected").val()){Z.find(".js-save-params").show()}else{if(Z.find(".js-save-params").is(":visible")){Z.find(".js-save-params").hide()}}}}});$(".js-save-params").live("click",function(){var ab=$(this);var X=$(this).attr("href");var W=$(this).closest("td").find(".param1-select option:selected").val();var aa=$(this).closest("td").find(".param2-select option:selected").val();var Z=new Object();if(typeof W!=="undefined"){Z.param1=W;var Y=$(this).closest("td").find(".param1-select option:selected").attr("title")}if(typeof aa!=="undefined"){Z.param2=aa}$.ajax({type:"POST",url:X,data:Z,success:function(){$('a[href="'+X+'"]').hide();if(typeof Y!=="undefined"){ab.closest("tr").find(".price").text(Y);var ae=ab.closest("tr").find(".item-total");var ac=ab.closest("tr").find(".js-qty-input").val()*Y;ae.text(ac);var ad=0;$("#cart-data .product-row").each(function(){ad+=Number($(this).find(".item-total").text())});$("#cart-data .cart-total").text(ad)}}});return false});$(".new-product-param1-box, .new-product-param2-box").hide();$("#new-product-select").live("change",function(){$("#product-price").hide();$(".new-product-param1-box").hide();$(".new-product-param2-box").hide();$(".new-product-save-params").hide();if($("#new-product-qty").is(":hidden")){$("#new-product-qty").show()}var W=$(this).find("option:selected");var Y=$(".new-product-param1-box");var X=Y.find(".new-product-param1-select");$.getJSON(base_url+admin_url+"/siteorder/ajax_get_cart_item_params/"+W.attr("id"),function(ac){if(ac!=null){var aa='<option selected="selected"></option>';for(P in ac.parameter_groups){var Z=ac.parameter_groups[P];var ab=Z.main_parameter_value.name;var ad="";if(Z.not_in_stock==true){ab+=" (под заказ)";ad='style="color: red;"'}aa+='<option value="'+Z.main_parameter_value.id+'" '+ad+' data-group="'+Z.id+'" data-price="'+Z.price+'">'+ab+"</option>"}X.html(aa);X.trigger("liszt:updated");Y.find("label").html(ac.possible_parameters.parameter_main.name);Y.show()}else{$("#product-price > span").html(W.attr("data-price")*$("#new-product-qty").val());$("#product-price").show();$(".new-product-save-params").show()}})});$(".new-product-param1-select").live("change",function(){if($(".new-product-save-params").is(":visible")){$(".new-product-save-params").hide()}var W=$(this).find("option:selected");var X=W.attr("data-group");$("#product-price > span").html(W.attr("data-price")*$("#new-product-qty").val());$("#product-price").show();$.getJSON(base_url+admin_url+"/siteorder/ajax_get_secondary_param_values/"+X,function(ab){if(ab!=null){var aa=$(".new-product-param2-box");var ae=aa.find("select");var Y='<option selected="selected"></option>';for(P in ab.secondary_parameter_values){var ad=ab.secondary_parameter_values[P];var Z=ad.name;var ac="";if(ad.not_in_stock==true){Z+=" (под заказ)";ac='style="color: red;"'}Y+='<option value="'+ad.id+'" '+ac+">"+Z+"</option>"}ae.html(Y);ae.trigger("liszt:updated");aa.find("label").html(ab.parameter_secondary_name);aa.show()}else{$(".new-product-save-params").show()}})});$(".new-product-param2-select").live("change",function(){$(".new-product-save-params").show()});$(".new-product-save-params").live("click",function(){var W={site_order_id:$('input[name="id"]').val(),product_id:$("#new-product-select option:selected").attr("id"),qty:$("#new-product-qty").val()};if(typeof $(".new-product-param1-select option:selected")!=="undefined"){W.param1=$(".new-product-param1-select option:selected").val()}if(typeof $(".new-product-param2-select option:selected")!=="undefined"){W.param2=$(".new-product-param2-select option:selected").val()}$.ajax({type:"POST",url:base_url+admin_url+"/siteorder/ajax_add_cart_item",data:W,success:function(X){k()}});return false});$("#new-product-qty").live("keyup change",function(){if($(".new-product-param1-box").is(":visible")==true){var W=$(".new-product-param1-select option:selected")}else{var W=$("#new-product-select").find("option:selected")}var X=$(this).val();$("#product-price > span").html(W.attr("data-price")*X);$("#product-discount-price > span").html(W.attr("data-discount-price")*X)});$(".js-qty-input").live("keyup change",function(){var W=$(this);$.ajax({type:"POST",url:base_url+admin_url+"/siteorder/ajax_change_qty/"+W.attr("data-cart-item-id"),data:{qty:W.val()},success:function(ab){var X=null;var Y=W.closest("tr").find(".price").text();var aa=W.closest("tr").find(".discount_price").text();var ac=W.closest("tr").find(".item-total");if(aa!=""){X=W.val()*aa}else{if(Y!=""){X=W.val()*Y}}ac.text(X);var Z=0;$("#cart-data .product-row").each(function(){Z+=Number($(this).find(".item-total").text())});k()}})});if($("#product_our_stock").length>0){function O(){if($("#product_our_stock").attr("checked")){$(".js-product-our-stock").attr("checked","checked")}}$("#product_our_stock").change(function(){O()})}if($("#supplierrequest_status").length>0){if($("#supplierrequest_status").val()=="delivered_to_zammler"){$("#supplierrequest_status").attr("disabled","disabled");$("#supplierrequest_status").trigger("liszt:updated")}}if($("#supplierrequest_ttn_code").length>0){var D=$("#supplierrequest_ttn_code").val();if(D!=""){var B=$(".act-list").find('a:contains("Создать ТТН")').filter(function(W){return $(this).text()==="Создать ТТН"});B.addClass("confirm").attr("title","В данной заявке уже указан ТТН, вы хотите создать новый?")}}if($("#supplierrequest_supplier_request_status").length>0){var C=$("#supplierrequest_supplier_request_status");var c=$('input[name="id"]').val();$(C).attr("data-initial-value",C.val());$("<a id='js-show-status-log-"+c+"' data-ajaxp-url='"+base_url+admin_url+"/eventlog/supplier_request/?supplier_request_id="+c+"'>Лог изменений</a>").insertAfter(C.next("div"));$("#js-show-status-log-"+c).live("click",function(){$.ajaxp2OpenPopup($(this).data().ajaxpUrl)})}if($("#list_supplierrequest").length>0){$("#list_supplierrequest tr").each(function(){var ab=$(this).find('input[type="checkbox"]').val();var aa=$(this).find("td:eq(8)");var Z=$.trim(aa.html());aa.html('<select class="status-select" id="js-status-'+ab+'">'+$('.filter-bar [name="supplier_request_status.id"]').html()+"</select>");aa.find("option:first").remove();$(aa).find("select:first option").each(function(){if($.trim($(this).attr("value"))==Z||$.trim($(this).text())==Z){$(this).attr("selected","selected")}});$("<a style='float: right;' id='js-show-status-log-"+ab+"' data-ajaxp-url='"+base_url+admin_url+"/eventlog/supplier_request/?supplier_request_id="+ab+"'>Log</a>").insertAfter(aa.find("select"));$("#js-show-status-log-"+ab).live("click",function(){$.ajaxp2OpenPopup($(this).data().ajaxpUrl)});aa.find("select:first").data("initial-value",$(aa).find("select:first").val());aa.find("select:first").change(function(){aa.find("select:first").attr("disabled","disabled");var ad=$(this).val();var ac=this;$.get(base_url+current_url+"/change_status?supplierRequestId="+ab+"&vl="+ad,function(ae){if(ae=="DONE"){$(ac).data("initial-value",ad);$(ac).css("borderColor","#0F0");setTimeout(function(){$(ac).css("borderColor","#06f")},500)}else{$(ac).css("borderColor","#F00");setTimeout(function(){$(ac).css("borderColor","#06f")},500)}$(ac).removeAttr("disabled")})});var X=$(this).find("td:eq(7)");var W=$.trim(X.html());$(X).data("initial-value",W);X.html('<input class="ttn-input" id="js-ttn-'+ab+'" value="'+W+'"/>');X.find("input:first").width(70);if(W!=""){var Y=$(this).find("td:eq(9)").find('a:contains("Создать ТТН")').filter(function(ac){return $(this).text()==="Создать ТТН"});Y.addClass("confirm").attr("title","В данной заявке уже указан ТТН, вы хотите создать новый?")}X.find("input:first").change(function(){$(this).attr("disabled","disabled");var ad=$(this).val();var ac=this;$.get(base_url+current_url+"/change_ttn?supplierRequestId="+ab+"&vl="+ad,function(ae){if(ae=="DONE"){$(X).data("initial-value",ad);$(ac).css("borderColor","#0F0");setTimeout(function(){$(ac).css("borderColor","#06f")},500)}X.find("input:first").removeAttr("disabled")})})})}if($("#product_bar_code").length>0){var b=$(".js-parameter-group-bar-code");if(b.length>0){$(".js-parameter-group-bar-code").addClass("required")}else{$("#product_bar_code").addClass("required")}$('<img alt="Generate barcode" class="barCodeGenButton" style="cursor: pointer; float: right;" title="Generate barcode" src="'+base_url+'web/images/admin/icons/dice.png">').insertBefore(".barCodeGen");$("#product_bar_code").prev("img").css({position:"absolute",top:"21px",right:"0px"});var M=$("input[name=id]").val();$(".barCodeGenButton").click(function(){var W="";var X=$(this).next("input.barCodeGen");if(X.attr("id")!=="product_bar_code"){W=X.data("groupId")}$.get(base_url+admin_url+"/product/ajax_generate_barcode?product_id="+M+"&group_id="+W).done(function(Y){X.val(Y)}).fail(function(){alert("error")})});$("#generateEmptyBarCodes").click(function(){$(".js-parameter-group-bar-code").each(function(W){if($(this).val()==""){$(this).prev(".barCodeGenButton").click()}})})}function d(){if(F.val()==""){$("#store_sender_warehouse").parent("div").hide();$("#store_sender_city").parent("div").hide();$("#store_sender_counterpartyaddress").parent("div").hide()}if(F.val()=="doors"){$("#store_sender_warehouse").parent("div").hide();$("#store_sender_city").parent("div").show();$("#store_sender_counterpartyaddress").parent("div").show()}if(F.val()=="warehouse"){$("#store_sender_warehouse").parent("div").show();$("#store_sender_city").parent("div").show();$("#store_sender_counterpartyaddress").parent("div").hide()}}function V(){if(q.val()==""){$("#store_receiver_warehouse").parent("div").hide();$("#store_receiver_city").parent("div").hide();$("#store_receiver_counterpartyaddress").parent("div").hide()}if(q.val()=="doors"){$("#store_receiver_warehouse").parent("div").hide();$("#store_receiver_city").parent("div").show();$("#store_receiver_counterpartyaddress").parent("div").show()}if(q.val()=="warehouse"){$("#store_receiver_warehouse").parent("div").show();$("#store_receiver_city").parent("div").show();$("#store_receiver_counterpartyaddress").parent("div").hide()}}if($("#store_sender_service_type").length>0){var F=$("#store_sender_service_type");d();F.change(function(){d()})}if($("#store_receiver_service_type").length>0){var q=$("#store_receiver_service_type");V();q.change(function(){V()})}if($("#store_sender_city").length>0){var f=$('select[name="sender_city"]');var E=$('select[name="sender_warehouse"]');var u=E.val();var J=$('select[name="sender_counterpartyaddress"]');var a=J.val();var g=$("#store_counterparty");f.change(function(){$.getJSON(base_url+admin_url+"/store/ajax_get_warehouse/"+$(this).val(),function(X){E.empty();var W='<option value="">--Не выбрано--</option>';if(X!=null){for(P in X){W+='<option value="'+X[P].id+'">'+X[P].name+"</option>"}}E.html(W);E.val(u);E.trigger("liszt:updated")});$.getJSON(base_url+admin_url+"/store/ajax_get_counterparty_address/"+g.val()+"/"+$(this).val(),function(X){J.empty();var W='<option value="">--Не выбрано--</option>';if(X!=null){for(P in X){W+='<option value="'+X[P].id+'">'+X[P].name+"</option>"}}J.html(W);J.val(a);J.trigger("liszt:updated")})});if(f.val()!=""){f.change()}}if($("#store_receiver_city").length>0){var o=$('select[name="receiver_city"]');var p=$('select[name="receiver_warehouse"]');var L=p.val();var s=$('select[name="receiver_counterpartyaddress"]');var j=s.val();var T=$("#receiver_counterparty");o.change(function(){$.getJSON(base_url+admin_url+"/store/ajax_get_warehouse/"+$(this).val(),function(X){p.empty();var W='<option value="">--Не выбрано--</option>';if(X!=null){for(P in X){W+='<option value="'+X[P].id+'">'+X[P].name+"</option>"}}p.html(W);p.val(L);p.trigger("liszt:updated")});$.getJSON(base_url+admin_url+"/store/ajax_get_counterparty_address/"+T.val()+"/"+$(this).val(),function(X){s.empty();var W='<option value="">--Не выбрано--</option>';if(X!=null){for(P in X){W+='<option value="'+X[P].id+'">'+X[P].name+"</option>"}}s.html(W);s.val(j);s.trigger("liszt:updated")})});if(o.val()!=""){o.change()}}if($("#store_counterparty").length>0){var g=$("#store_counterparty");var x=$('select[name="sender_counterpartyaddress"]');var e=x.val();var S=$('select[name="counterpartycontactperson"]');var K=S.val();$("<br><hr><br>").insertBefore(g.parent(".group"));g.change(function(){$.getJSON(base_url+admin_url+"/store/ajax_get_counterparty_address/"+$(this).val(),function(X){x.empty();var W='<option value="">--Не выбрано--</option>';if(X!=null){for(P in X){W+='<option value="'+X[P].id+'">'+X[P].name+"</option>"}}x.html(W);x.val(e);x.trigger("liszt:updated")});$.getJSON(base_url+admin_url+"/store/ajax_get_counterparty_contact/"+$(this).val(),function(X){S.empty();var W='<option value="">--Не выбрано--</option>';if(X!=null){for(P in X){W+='<option value="'+X[P].id+'">'+X[P].name+"</option>"}}S.html(W);S.val(K);S.trigger("liszt:updated")})});if(g.val()!=""){g.change()}}if($("#store_receiver_counterparty").length>0){var T=$("#store_receiver_counterparty");var m=$('select[name="receiver_counterpartyaddress"]');var n=m.val();var I=$('select[name="receiver_counterpartycontactperson"]');var N=I.val();$("<br><hr><br>").insertBefore(T.parent(".group"));$("<br><hr><br>").insertAfter($("#store_receiver_counterpartycontactperson").parent(".group"));T.change(function(){$.getJSON(base_url+admin_url+"/store/ajax_get_counterparty_address/"+$(this).val(),function(X){m.empty();var W='<option value="">--Не выбрано--</option>';if(X!=null){for(P in X){W+='<option value="'+X[P].id+'">'+X[P].name+"</option>"}}m.html(W);m.val(n);m.trigger("liszt:updated")});$.getJSON(base_url+admin_url+"/store/ajax_get_counterparty_contact/"+$(this).val(),function(X){I.empty();var W='<option value="">--Не выбрано--</option>';if(X!=null){for(P in X){W+='<option value="'+X[P].id+'">'+X[P].name+"</option>"}}I.html(W);I.val(N);I.trigger("liszt:updated")})});if(T.val()!=""){T.change()}}});