(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../xml/xml"),require("../meta"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../xml/xml","../meta"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("markdown",function(G,n){var j=a.getMode(G,"text/html");var d=j.name=="null";function f(K){if(a.findModeByName){var L=a.findModeByName(K);if(L){K=L.mime||L.mimes[0]}}var M=a.getMode(G,K);return M.name=="null"?null:M}if(n.highlightFormatting===undefined){n.highlightFormatting=false}if(n.maxBlockquoteDepth===undefined){n.maxBlockquoteDepth=0}if(n.underscoresBreakWords===undefined){n.underscoresBreakWords=true}if(n.taskLists===undefined){n.taskLists=false}if(n.strikethrough===undefined){n.strikethrough=false}if(n.tokenTypeOverrides===undefined){n.tokenTypeOverrides={}}var p={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"tag",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"};for(var I in p){if(p.hasOwnProperty(I)&&n.tokenTypeOverrides[I]){p[I]=n.tokenTypeOverrides[I]}}var J=/^([*\-_])(?:\s*\1){2,}\s*$/,t=/^[*\-+]\s+/,z=/^[0-9]+([.)])\s+/,D=/^\[(x| )\](?=\s)/,o=n.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,F=/^ *(?:\={1,}|-{1,})\s*$/,h=/^[^#!\[\]*_\\<>` "'(~]+/,E=new RegExp("^("+(n.fencedCodeBlocks===true?"~~~+|```+":n.fencedCodeBlocks)+")[ \\t]*([\\w+#-]*)");function g(M,L,K){L.f=L.inline=K;return K(M,L)}function v(M,L,K){L.f=L.block=K;return K(M,L)}function s(K){return !K||!/\S/.test(K.string)}function r(K){K.linkTitle=false;K.em=false;K.strong=false;K.strikethrough=false;K.quote=0;K.indentedCode=false;if(d&&K.f==A){K.f=u;K.block=m}K.trailingSpace=0;K.trailingSpaceNewLine=false;K.prevLine=K.thisLine;K.thisLine=null;return null}function m(Q,P){var O=Q.sol();var M=P.list!==false,K=P.indentedCode;P.indentedCode=false;if(M){if(P.indentationDiff>=0){if(P.indentationDiff<4){P.indentation-=P.indentationDiff}P.list=null}else{if(P.indentation>0){P.list=null}else{P.list=false}}}var L=null;if(P.indentationDiff>=4){Q.skipToEnd();if(K||s(P.prevLine)){P.indentation-=4;P.indentedCode=true;return p.code}else{return null}}else{if(Q.eatSpace()){return null}else{if((L=Q.match(o))&&L[1].length<=6){P.header=L[1].length;if(n.highlightFormatting){P.formatting="header"}P.f=P.inline;return y(P)}else{if(!s(P.prevLine)&&!P.quote&&!M&&!K&&(L=Q.match(F))){P.header=L[0].charAt(0)=="="?1:2;if(n.highlightFormatting){P.formatting="header"}P.f=P.inline;return y(P)}else{if(Q.eat(">")){P.quote=O?1:P.quote+1;if(n.highlightFormatting){P.formatting="quote"}Q.eatSpace();return y(P)}else{if(Q.peek()==="["){return g(Q,P,l)}else{if(Q.match(J,true)){P.hr=true;return p.hr}else{if((s(P.prevLine)||M)&&(Q.match(t,false)||Q.match(z,false))){var N=null;if(Q.match(t,true)){N="ul"}else{Q.match(z,true);N="ol"}P.indentation=Q.column()+Q.current().length;P.list=true;while(P.listStack&&Q.column()<P.listStack[P.listStack.length-1]){P.listStack.pop()}P.listStack.push(P.indentation);if(n.taskLists&&Q.match(D,false)){P.taskList=true}P.f=P.inline;if(n.highlightFormatting){P.formatting=["list","list-"+N]}return y(P)}else{if(n.fencedCodeBlocks&&(L=Q.match(E,true))){P.fencedChars=L[1];P.localMode=f(L[2]);if(P.localMode){P.localState=P.localMode.startState()}P.f=P.block=x;if(n.highlightFormatting){P.formatting="code-block"}P.code=-1;return y(P)}}}}}}}}}return g(Q,P,P.inline)}function A(N,M){var L=j.token(N,M.htmlState);if(!d){var K=a.innerMode(j,M.htmlState);if((K.mode.name=="xml"&&K.state.tagStart===null&&(!K.state.context&&K.state.tokenize.isInText))||(M.md_inside&&N.current().indexOf(">")>-1)){M.f=u;M.block=m;M.htmlState=null}}return L}function x(L,K){if(K.fencedChars&&L.match(K.fencedChars,false)){K.localMode=K.localState=null;K.f=K.block=B;return null}else{if(K.localMode){return K.localMode.token(L,K.localState)}else{L.skipToEnd();return p.code}}}function B(M,L){M.match(L.fencedChars);L.block=m;L.f=u;L.fencedChars=null;if(n.highlightFormatting){L.formatting="code-block"}L.code=1;var K=y(L);L.code=0;return K}function y(N){var M=[];if(N.formatting){M.push(p.formatting);if(typeof N.formatting==="string"){N.formatting=[N.formatting]}for(var K=0;K<N.formatting.length;K++){M.push(p.formatting+"-"+N.formatting[K]);if(N.formatting[K]==="header"){M.push(p.formatting+"-"+N.formatting[K]+"-"+N.header)}if(N.formatting[K]==="quote"){if(!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=N.quote){M.push(p.formatting+"-"+N.formatting[K]+"-"+N.quote)}else{M.push("error")}}}}if(N.taskOpen){M.push("meta");return M.length?M.join(" "):null}if(N.taskClosed){M.push("property");return M.length?M.join(" "):null}if(N.linkHref){M.push(p.linkHref,"url")}else{if(N.strong){M.push(p.strong)}if(N.em){M.push(p.em)}if(N.strikethrough){M.push(p.strikethrough)}if(N.linkText){M.push(p.linkText)}if(N.code){M.push(p.code)}}if(N.header){M.push(p.header,p.header+"-"+N.header)}if(N.quote){M.push(p.quote);if(!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=N.quote){M.push(p.quote+"-"+N.quote)}else{M.push(p.quote+"-"+n.maxBlockquoteDepth)}}if(N.list!==false){var L=(N.listStack.length-1)%3;if(!L){M.push(p.list1)}else{if(L===1){M.push(p.list2)}else{M.push(p.list3)}}}if(N.trailingSpaceNewLine){M.push("trailing-space-new-line")}else{if(N.trailingSpace){M.push("trailing-space-"+(N.trailingSpace%2?"a":"b"))}}return M.length?M.join(" "):null}function c(L,K){if(L.match(h,true)){return y(K)}return undefined}function u(P,O){var aa=O.text(P,O);if(typeof aa!=="undefined"){return aa}if(O.list){O.list=null;return y(O)}if(O.taskList){var W=P.match(D,true)[1]!=="x";if(W){O.taskOpen=true}else{O.taskClosed=true}if(n.highlightFormatting){O.formatting="task"}O.taskList=false;return y(O)}O.taskOpen=false;O.taskClosed=false;if(O.header&&P.match(/^#+$/,true)){if(n.highlightFormatting){O.formatting="header"}return y(O)}var K=P.sol();var U=P.next();if(O.linkTitle){O.linkTitle=false;var Z=U;if(U==="("){Z=")"}Z=(Z+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var L="^\\s*(?:[^"+Z+"\\\\]+|\\\\\\\\|\\\\.)"+Z;if(P.match(new RegExp(L),true)){return p.linkHref}}if(U==="`"){var Y=O.formatting;if(n.highlightFormatting){O.formatting="code"}P.eatWhile("`");var R=P.current().length;if(O.code==0){O.code=R;return y(O)}else{if(R==O.code){var V=y(O);O.code=0;return V}else{O.formatting=Y;return y(O)}}}else{if(O.code){return y(O)}}if(U==="\\"){P.next();if(n.highlightFormatting){var M=y(O);var T=p.formatting+"-escape";return M?M+" "+T:T}}if(U==="!"&&P.match(/\[[^\]]*\] ?(?:\(|\[)/,false)){P.match(/\[[^\]]*\]/);O.inline=O.f=i;return p.image}if(U==="["&&P.match(/.*\](\(.*\)| ?\[.*\])/,false)){O.linkText=true;if(n.highlightFormatting){O.formatting="link"}return y(O)}if(U==="]"&&O.linkText&&P.match(/\(.*\)| ?\[.*\]/,false)){if(n.highlightFormatting){O.formatting="link"}var M=y(O);O.linkText=false;O.inline=O.f=i;return M}if(U==="<"&&P.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,false)){O.f=O.inline=C;if(n.highlightFormatting){O.formatting="link"}var M=y(O);if(M){M+=" "}else{M=""}return M+p.linkInline}if(U==="<"&&P.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,false)){O.f=O.inline=C;if(n.highlightFormatting){O.formatting="link"}var M=y(O);if(M){M+=" "}else{M=""}return M+p.linkEmail}if(U==="<"&&P.match(/^(!--|\w)/,false)){var N=P.string.indexOf(">",P.pos);if(N!=-1){var X=P.string.substring(P.start,N);if(/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(X)){O.md_inside=true}}P.backUp(1);O.htmlState=a.startState(j);return v(P,O,A)}if(U==="<"&&P.match(/^\/\w*?>/)){O.md_inside=false;return"tag"}var S=false;if(!n.underscoresBreakWords){if(U==="_"&&P.peek()!=="_"&&P.match(/(\w)/,false)){var Q=P.pos-2;if(Q>=0){var ab=P.string.charAt(Q);if(ab!=="_"&&ab.match(/(\w)/,false)){S=true}}}}if(U==="*"||(U==="_"&&!S)){if(K&&P.peek()===" "){}else{if(O.strong===U&&P.eat(U)){if(n.highlightFormatting){O.formatting="strong"}var V=y(O);O.strong=false;return V}else{if(!O.strong&&P.eat(U)){O.strong=U;if(n.highlightFormatting){O.formatting="strong"}return y(O)}else{if(O.em===U){if(n.highlightFormatting){O.formatting="em"}var V=y(O);O.em=false;return V}else{if(!O.em){O.em=U;if(n.highlightFormatting){O.formatting="em"}return y(O)}}}}}}else{if(U===" "){if(P.eat("*")||P.eat("_")){if(P.peek()===" "){return y(O)}else{P.backUp(1)}}}}if(n.strikethrough){if(U==="~"&&P.eatWhile(U)){if(O.strikethrough){if(n.highlightFormatting){O.formatting="strikethrough"}var V=y(O);O.strikethrough=false;return V}else{if(P.match(/^[^\s]/,false)){O.strikethrough=true;if(n.highlightFormatting){O.formatting="strikethrough"}return y(O)}}}else{if(U===" "){if(P.match(/^~~/,true)){if(P.peek()===" "){return y(O)}else{P.backUp(2)}}}}}if(U===" "){if(P.match(/ +$/,false)){O.trailingSpace++}else{if(O.trailingSpace){O.trailingSpaceNewLine=true}}}return y(O)}function C(N,M){var L=N.next();if(L===">"){M.f=M.inline=u;if(n.highlightFormatting){M.formatting="link"}var K=y(M);if(K){K+=" "}else{K=""}return K+p.linkInline}N.match(/^[^>]+/,true);return p.linkInline}function i(M,L){if(M.eatSpace()){return null}var K=M.next();if(K==="("||K==="["){L.f=L.inline=k(K==="("?")":"]");if(n.highlightFormatting){L.formatting="link-string"}L.linkHref=true;return y(L)}return"error"}function k(K){return function(O,N){var M=O.next();if(M===K){N.f=N.inline=u;if(n.highlightFormatting){N.formatting="link-string"}var L=y(N);N.linkHref=false;return L}if(O.match(e(K),true)){O.backUp(1)}N.linkHref=true;return y(N)}}function l(L,K){if(L.match(/^([^\]\\]|\\.)*\]:/,false)){K.f=H;L.next();if(n.highlightFormatting){K.formatting="link"}K.linkText=true;return y(K)}return g(L,K,u)}function H(M,L){if(M.match(/^\]:/,true)){L.f=L.inline=b;if(n.highlightFormatting){L.formatting="link"}var K=y(L);L.linkText=false;return K}M.match(/^([^\]\\]|\\.)+/,true);return p.linkText}function b(L,K){if(L.eatSpace()){return null}L.match(/^[^\s]+/,true);if(L.peek()===undefined){K.linkTitle=true}else{L.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,true)}K.f=K.inline=u;return p.linkHref+" url"}var w=[];function e(K){if(!w[K]){K=(K+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");w[K]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+K+")")}return w[K]}var q={startState:function(){return{f:m,prevLine:null,thisLine:null,block:m,htmlState:null,indentation:0,inline:u,text:c,formatting:false,linkText:false,linkHref:false,linkTitle:false,code:0,em:false,strong:false,header:0,hr:false,taskList:false,list:false,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:false,strikethrough:false,fencedChars:null}},copyState:function(K){return{f:K.f,prevLine:K.prevLine,thisLine:K.thisLine,block:K.block,htmlState:K.htmlState&&a.copyState(j,K.htmlState),indentation:K.indentation,localMode:K.localMode,localState:K.localMode?a.copyState(K.localMode,K.localState):null,inline:K.inline,text:K.text,formatting:false,linkTitle:K.linkTitle,code:K.code,em:K.em,strong:K.strong,strikethrough:K.strikethrough,header:K.header,hr:K.hr,taskList:K.taskList,list:K.list,listStack:K.listStack.slice(0),quote:K.quote,indentedCode:K.indentedCode,trailingSpace:K.trailingSpace,trailingSpaceNewLine:K.trailingSpaceNewLine,md_inside:K.md_inside,fencedChars:K.fencedChars}},token:function(N,M){M.formatting=false;if(N!=M.thisLine){var K=M.header||M.hr;M.header=0;M.hr=false;if(N.match(/^\s*$/,true)||K){r(M);if(!K){return null}M.prevLine=null}M.prevLine=M.thisLine;M.thisLine=N;M.taskList=false;M.trailingSpace=0;M.trailingSpaceNewLine=false;M.f=M.block;var L=N.match(/^\s*/,true)[0].replace(/\t/g,"    ").length;M.indentationDiff=Math.min(L-M.indentation,4);M.indentation=M.indentation+M.indentationDiff;if(L>0){return null}}return M.f(N,M)},innerMode:function(K){if(K.block==A){return{state:K.htmlState,mode:j}}if(K.localState){return{state:K.localState,mode:K.localMode}}return{state:K,mode:q}},blankLine:r,getType:y,fold:"markdown"};return q},"xml");a.defineMIME("text/x-markdown","markdown")});